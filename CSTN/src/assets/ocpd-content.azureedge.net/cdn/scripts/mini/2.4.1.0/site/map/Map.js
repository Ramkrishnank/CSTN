/*! tools 2018-02-09 */
function Map(){}function MyLocationPosition(a){require(["esri/geometry/Point"],function(b){var c=new b(a.coords.longitude,a.coords.latitude);Map.CreateCurrentLocationGraphic(c)})}function MyLocationPositionError(a){switch(a.code){case a.PERMISSION_DENIED:alert("User denied the request for Geolocation.");break;case a.POSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case a.TIMEOUT:alert("The request to get user location timed out.");break;case a.UNKNOWN_ERROR:alert("An unknown error occurred.")}}function WhatAttributeCategoriesSelected(a){var b=$("#whatListView").find(":input"),c=MapSettings.WhatSelectedAttributeCategories;for(i=0;i<c.length;i++){var d=c[i];for(j=0;j<b.length;j++)if(b[j].name==d){b[j].checked="true";break}}}function SetPanelVerticalPosition(){$("#mapPanels").css({"margin-top":-1*$(window).scrollTop()+"px"})}Map.MainMap=null,Map.BasemapLayer=null,Map.OmegaBasemapLayer=null,Map.CenterPoint=null,Map.StartupType="",Map.StartupAddress="",Map.StartupX="",Map.StartupY="",Map.ResourcePath="",Map.VersionPath="",Map.ResultPinGraphicsLayer=null,Map.ResultSelectionGraphicsLayer=null,Map.ResultLabelGraphicsLayer=null,Map.PreviouslySelectedPin=null,Map.PreviouslySelectedLabel=null,Map.PreviouslySelectedSelection=null,Map.PreviouslySelectedOrganizationGraphic=null,Map.PinLabelSelected=!1,Map.PinLabelConflictSelect=!1,Map.ZoomToRecord=!1,Map.SearchByLocation=!1,Map.MapFiltersPanelLoaded=!1,Map.WhenPanelInitialized=!1,Map.ToolBar=null,Map.MeasureDistanceEnabled=!1,Map.MeasureDistanceLine=null,Map.MeasureDistanceGraphic=null,Map.DetailRecordAddressLineDistance=0,Map.DetailRecordAddressLineDistanceUnit="mile",Map.DetailRecordAddress="",Map.DetailRecordID="",Map.OrganizationID="",Map.OffenderDisclaimerVisible=!1,Map.OffenderDisclaimerAccepted=!1,Map.OffenderDisclaimerShown=!1,Map.OffenderStatusBarShown=!1,Map.OffenderStatusBarDismissed=!1,Map.SelectedFilterType="Previous",Map.SelectedPreviousShortcutId="-1",Map.PreviousNumDays=0,Map.PreviousName="Previous 7 Days",Map.ExplicitStartDate="",Map.ExplicitEndDate="",Map.VisibleAgencies=null,Map.AgenciesByExtent=[],Map.SelectedAgencyByExtent=[],Map.AgencyFilter=[],Map.AgencyFilterToggle=!1,Map.OrganizationDetailOpen=!1,Map.DefaultAgencyID=-1,Map.AlertsPageOpen=!1,Map.ReportsPageOpen=!1,Map.UnMappedOrgIDs=[],Map.HasCrimeRecords=!1,Map.HasOffenderRecords=!1,Map.HasOffenderData=!1,Map.PrintMapExtent=null,Map.PrintMapBufferDistance="",Map.PrintMapBufferAddress="",Map.HasReachedMaxRecordCount=!1,Map.NavBarOpen=!1,Map.UserAccess=null,Map.Init=function(a){try{if(Map.OpenModalOverlay(),null!=a.UserSession&&(Map.UserAccess=a.UserSession.ua),Map.ResourcePath=a.ResourcePath,Map.VersionPath=a.VersionPath,$("#divClientLogIn").hide(),Staging.GetSessionStatus(),MapSettings.IsLoaded||MapSettings.Load(a),Map.MapFiltersPanelLoaded||(Map.LoadPanels(a),Map.MapFiltersPanelLoaded=!0),2==MapSettings.MapType&&(Map.LoadMobileMainMenu(),Map.LoadMobileSearchMenus()),(navigator.userAgent.indexOf("iPhone",0)>-1||navigator.userAgent.indexOf("Android",0)>-1)&&$("#mapTools").hide(),null==Map.MainMap){var b=Map.OmegaBasemapLayer=MapSettings.GetBasemapById(MapSettings.DefaultBackgroundLayerID);require(["esri/map","esri/layers/ArcGISTiledMapServiceLayer","dojo/domReady!"],function(c,d){Map.BasemapLayer=Map.PrepareBasemapLayer(b),require(["esri/geometry/Point","esri/geometry/Extent","esri/SpatialReference"],function(b,d,e){if(1==MapSettings.UseDefaultSpatialFilter){var f=MapSettings.DefaultSpatialFilter;if(f.$type.indexOf("AddressSpatialFilter")){Map.CurrentSpatialFilterType=0,Map.AddressFilterObj=Map.CreateAddressSpatialFilterObject(f.ad,f.x,f.y,f.bd),Map.CenterPoint=new b(f.x,f.y,new e({wkid:102100}));var g=new d(MapSettings.XMin,MapSettings.YMin,MapSettings.XMax,MapSettings.YMax,new e({wkid:102100}));Map.MainMap=new c("map",{sliderStyle:"none",extent:g,slider:!1,minScale:MapSettings.MaxScale,maxScale:MapSettings.MinScale})}else f.$type.indexOf("GeographySpatialFilter")&&(Map.CurrentSpatialFilterType=1)}else if(1==MapSettings.ShareMapEnabled){Map.CurrentSpatialFilterType=2,MapSettings.OrganizationFilter.$type.indexOf("NoOrganizationFilter")==-1&&(Map.AgencyFilter=MapSettings.OrganizationFilter.ids);var g=new d(MapSettings.XMin,MapSettings.YMin,MapSettings.XMax,MapSettings.YMax,new e({wkid:102100}));Map.MainMap=new c("map",{sliderStyle:"none",extent:g,slider:!1,minScale:MapSettings.MaxScale,maxScale:MapSettings.MinScale})}else if(1==MapSettings.CrimeAlertEnabled){Map.CurrentSpatialFilterType=2;var g=new d(MapSettings.XMin,MapSettings.YMin,MapSettings.XMax,MapSettings.YMax,new e({wkid:102100}));Map.MainMap=new c("map",{sliderStyle:"none",extent:g,slider:!1,minScale:MapSettings.MaxScale,maxScale:MapSettings.MinScale})}else Map.CenterPoint=new b(MapSettings.CenterPointX,MapSettings.CenterPointY,new e({wkid:102100})),Map.MainMap=new c("map",{sliderStyle:"none",scale:MapSettings.CenterPointScale,center:Map.CenterPoint,slider:!1,minScale:MapSettings.MaxScale,maxScale:MapSettings.MinScale});MapSettings.UseMapScale&&require(["esri/dijit/Scalebar"],function(a){var b=new a({map:Map.MainMap,attachTo:"bottom-center",scalebarUnit:"dual"})}),Map.MainMap.addLayer(Map.BasemapLayer,0),Map.MainMap.on("load",Map.LoadMap),Map.MainMap.on("extent-change",Map.MapExtentChanged),Map.MainMap.on("zoom-end",function(a){EventTracking.MapZoomLevelChanged(a.level)}),Map.MainMap.on("click",Map.MapClicked),Map.MainMap.on("dbl-click",Map.MapDoubleClicked),Map.MainMap.on("mouse-move",Map.MapMouseMove),Map.MainMap.on("mouse-up",Map.MouseUp),dojo.connect(Map.MainMap.infoWindow,"onHide",Map.CloseAddressInfoWindow),dojo.connect(Map.MainMap.infoWindow,"onShow",Map.OpenAddressInfoWindow),Map.StartupType=a.Startup.$type,Map.StartupAddress=a.Startup.ad,null!=a.Startup.sv&&(Map.StartupX=a.Startup.sv.x,Map.StartupY=a.Startup.sv.y)})}),$("#mapAgency").val()>-1&&(Map.DefaultAgencyID=$("#mapAgency").val())}}catch(c){Map.LoadErrorModal("Map Init - "+c,5,851e4)}},Map.LoadMap=function(){"OmegaGroup.Civic.Data.Map.AddressStartup, OmegaGroup.Civic.Data"==Map.StartupType&&($("#locationSearch").val(Map.StartupAddress),$(".clearSearch").show(),require(["esri/geometry/Point","esri/SpatialReference"],function(a,b){var c=new a(Map.StartupX,Map.StartupY,new b(102100));Map.ClearSpatialFilter(),Map.CreateAddressGraphic(c,Map.StartupAddress,""),Map.MainMap.infoWindow.show(c)}))},Map.CreateInfoWindow=function(){var a=null;return require(["dojo/dom","dojo/dom-construct","dojo/string","myModuls/InfoWindow"],function(b,c,d,e){a=new e({domNode:c.create("div",null,b.byId("map"))})}),a},Map.BuildResultPinGraphicsLayer=function(){var a=null;return require(["esri/layers/GraphicsLayer"],function(b){var c=Map.CreateResultPinUniqueValueRenderer();a=new b({id:"MapPinGraphics"}),a.setRenderer(c),a.on("mouse-up",Map.ResultPinGraphicMouseUp)}),a},Map.CreateResultPinUniqueValueRenderer=function(){var a=null;return require(["esri/renderers/UniqueValueRenderer","esri/Color","esri/symbols/PictureMarkerSymbol"],function(b,c,d){var e=new d(Map.ResourcePath+"/images/map/result/pin/"+MapSettings.ResultDefaultSymbolID+".svg",47,35);e.xoffset=MapSettings.ResultPinOffsetX,e.yoffset=MapSettings.ResultPinOffsetY,a=new b(e,"LegendID");for(var f=0;f<MapSettings.ResultLegendValues.length;f++){var g=new d(Map.ResourcePath+"/images/map/result/pin/"+MapSettings.ResultLegendValues[f]+".svg",47,35);g.xoffset=MapSettings.ResultPinOffsetX,g.yoffset=MapSettings.ResultPinOffsetY,a.addValue(MapSettings.ResultLegendValues[f],g)}}),a},Map.BuildResultLabelGraphicsLayer=function(){var a=null;return require(["esri/layers/GraphicsLayer","esri/InfoTemplate"],function(b,c){var d=Map.CreateResultLabelUniqueValueRenderer();a=new b({id:"MapLabelGraphics"}),a.setRenderer(d)}),a.on("mouse-down",Map.ResultLabelGraphicsLayerMouseDown),a},Map.ResultLabelGraphicsLayerMouseDown=function(a){var b=a.graphic,c=!1;null!=b&&(Map.MeasureDistanceEnabled||(Map.PreviouslySelectedLabel==Map.ResultLabelGraphicsLayer.graphics[0]&&Map.GetDetailRecordInformation(Map.PreviouslySelectedPin),Map.PreviouslySelectedLabel=Map.ResultLabelGraphicsLayer.graphics[0],Map.PreviouslySelectedSelection=Map.ResultSelectionGraphicsLayer.graphics[0],Map.PinLabelSelected=!0,Map.ResultLabelGraphicsLayer.clear(),Map.ResultSelectionGraphicsLayer.clear()))},Map.ResultPinGraphicMouseUp=function(a){var b=a.graphic,c=Map.ResultPinGraphicsLayer.graphics,d=null,e=null,f=!1;if(null!=b.attributes&&(e=b.attributes.IDs,!Map.MeasureDistanceEnabled)){Map.PinLabelConflictSelect=!0;for(var g=0;g<c.length;g++)if(null!=c[g].attributes){for(var h=0;h<c[g].attributes.IDs.length;h++)if(c[g].attributes.IDs[h]==e[h]){d=c[g],f=!0;break}if(1==f)break}null!=d&&(Map.TogglePinGraphic(!0),Map.DisplaySelectedValueGraphicsLayers(b),Map.NavBarOpen&&Map.NavTriggerClick(),Map.GetDetailRecordInformation(b),Map.PreviouslySelectedPin=b,Map.TogglePinGraphic(!1))}},Map.CreateResultLabelUniqueValueRenderer=function(){var a=null;return require(["esri/renderers/UniqueValueRenderer","esri/Color","esri/symbols/PictureMarkerSymbol"],function(b,c,d){var e=new d(Map.ResourcePath+"/images/map/result/label/"+MapSettings.CultureFolder+MapSettings.ResultDefaultSymbolID+".svg",151,82);e.xoffset=MapSettings.ResultLabelOffsetX,e.yoffset=MapSettings.ResultLabelOffsetY,a=new b(e,"LegendID");for(var f=0;f<MapSettings.ResultLegendValues.length;f++)Map.AddResultLabelRendererPictureMarker(f,a)}),a},Map.AddResultLabelRendererPictureMarker=function(a,b){var c=0,d=0;100==a||a>=102?(c=212,d=80):101==a?(c=132,d=83):(c=151,d=82),require(["esri/symbols/PictureMarkerSymbol"],function(e){var f=new e(Map.ResourcePath+"/images/map/result/label/"+MapSettings.CultureFolder+MapSettings.ResultLegendValues[a]+".svg",c,d);f.xoffset=MapSettings.ResultLabelOffsetX,f.yoffset=MapSettings.ResultLabelOffsetY,b.addValue(MapSettings.ResultLegendValues[a],f)})},Map.BuildResultSelectionGraphicsLayer=function(){var a=null;return require(["esri/layers/GraphicsLayer","esri/InfoTemplate"],function(b,c){var d=Map.CreateResultSelectionUniqueValueRenderer();a=new b({id:"MapSelectionGraphics"}),a.setRenderer(d)}),a},Map.CreateResultSelectionUniqueValueRenderer=function(){var a=null;return require(["esri/renderers/UniqueValueRenderer","esri/Color","esri/symbols/PictureMarkerSymbol"],function(b,c,d){var e=new d(Map.ResourcePath+"/images/map/result/selection/"+MapSettings.ResultDefaultSymbolID+".svg",50,50);e.xoffset=MapSettings.ResultSelectionOffsetX,e.yoffset=MapSettings.ResultSelectionOffsetY,a=new b(e,"LegendID");for(var f=0;f<MapSettings.ResultLegendValues.length;f++){var g=new d(Map.ResourcePath+"/images/map/result/selection/"+MapSettings.ResultLegendValues[f]+".svg",50,50);g.xoffset=MapSettings.ResultSelectionOffsetX,g.yoffset=MapSettings.ResultSelectionOffsetY,a.addValue(MapSettings.ResultLegendValues[f],g)}}),a},Map.DisplaySelectedValueGraphicsLayers=function(a){if("undefined"!=a.attributes&&null!=a.attributes){var b=a.geometry.x,c=a.geometry.y,d=a.attributes.LegendID,e=a.attributes.IDs;require(["esri/geometry/Point","esri/graphic","esri/SpatialReference"],function(a,f,g){var h=new a(b,c,new g({wkid:102100})),i=new f(h,null,{LegendID:d,IDs:e},null),j=new f(h,null,{LegendID:d,IDs:e},null);Map.PreviouslySelectedLabel=i,Map.PreviouslySelectedSelection=j,Map.ResultLabelGraphicsLayer.add(i),Map.ResultSelectionGraphicsLayer.add(j)})}},Map.LoadGraphics=function(){Map.ResultSelectionGraphicsLayer=Map.BuildResultSelectionGraphicsLayer(),Map.ResultPinGraphicsLayer=Map.BuildResultPinGraphicsLayer(),Map.ResultLabelGraphicsLayer=Map.BuildResultLabelGraphicsLayer(),Map.OrganizationGraphicsLayer=Map.BuildOrganizationGraphicsLayer(),Map.OrganizationSelectionGraphicsLayer=Map.BuildSelectionOrganizationGraphicsLayer(),Map.MainMap.addLayer(Map.ResultSelectionGraphicsLayer),Map.MainMap.addLayer(Map.ResultPinGraphicsLayer),Map.MainMap.addLayer(Map.ResultLabelGraphicsLayer),Map.MainMap.addLayer(Map.OrganizationSelectionGraphicsLayer),Map.MainMap.addLayer(Map.OrganizationGraphicsLayer)},Map.TogglePinGraphic=function(a){null!=Map.PreviouslySelectedPin&&(a?(Map.ResultSelectionGraphicsLayer.clear(),Map.ResultLabelGraphicsLayer.clear(),Map.PreviouslySelectedPin.show(),Map.PreviouslySelectedPin=null):Map.PreviouslySelectedPin.hide())},Map.CurrentAddressGraphic=null,Map.ShowInfoPopUp=!1,Map.CreateAddressGraphic=function(a,b,c){var d=!1;null!=Map.CurrentAddressGraphic&&(Map.CurrentAddressGraphic.geometry.x==a.x&&Map.CurrentAddressGraphic.geometry.y==a.y?d=!0:Map.RemoveAddressGraphic()),null!=Map.CurrentLocationGraphic&&(Map.MainMap.graphics.remove(Map.CurrentLocationGraphic),Map.CurrentLocationGraphic=null),null!=Map.CurrentDetailRecordAddressGraphic&&(Map.MainMap.graphics.remove(Map.CurrentDetailRecordAddressGraphic),Map.MainMap.graphics.remove(Map.CurrentDetailRecordLineDistanceGraphic),Map.CurrentDetailRecordAddressGraphic=null,Map.CurrentDetailRecordLineDistanceGraphic=null),require(["esri/graphic","esri/symbols/PictureMarkerSymbol","esri/Color","esri/InfoTemplate","esri/geometry/Point"],function(e,f,g,h,i){var j=new f(Map.ResourcePath+"/images/map/address-marker.svg",25,25),k=new i(a);if(0==d){var l=new h("Search Location",'<span style="font-weight:bold;">'+b+"</span>");Map.CurrentAddressGraphic=new e(k,j,null,l),Map.MainMap.infoWindow.setContent('<span style="font-weight:bold;">'+b+"</span>"),Map.MainMap.infoWindow.setTitle("Search Location"),Map.MainMap.infoWindow.resize(215,100),Map.ShowInfoPopUp=!0,0==MapSettings.ShareMapEnabled&&"locationsearch"==c?(Map.MainMap.setScale(MapSettings.MyLocationScale),Map.MainMap.centerAt(k).then(function(){Map.MainMap.infoWindow.show(k)})):Map.MainMap.infoWindow.show(k)}else 1==Map.ShowInfoPopUp&&Map.MainMap.infoWindow.show(k)})},Map.CloseAddressInfoWindow=function(a){Map.ShowInfoPopUp=!1},Map.OpenAddressInfoWindow=function(a){$(".esriPopup").css("z-index","0"),Map.ShowInfoPopUp=!0},Map.CurrentDetailRecordAddressGraphic=null,Map.CurrentDetailRecordLineDistanceGraphic=null,Map.CreateDetailRecordAddressGraphic=function(a,b,c){Map.RemoveAddressGraphic(),null!=Map.CurrentLocationGraphic&&(Map.MainMap.graphics.remove(Map.CurrentLocationGraphic),Map.CurrentLocationGraphic=null),null!=Map.CurrentDetailRecordAddressGraphic&&(Map.MainMap.graphics.remove(Map.CurrentDetailRecordAddressGraphic),Map.MainMap.graphics.remove(Map.CurrentDetailRecordLineDistanceGraphic),Map.CurrentDetailRecordAddressGraphic=null,Map.CurrentDetailRecordLineDistanceGraphic=null),require(["esri/graphic","esri/symbols/PictureMarkerSymbol","esri/Color","esri/InfoTemplate","esri/geometry/Polyline","esri/symbols/SimpleLineSymbol","esri/geometry/geodesicUtils","esri/units","esri/geometry/webMercatorUtils"],function(d,e,f,g,h,i,j,k,l){var m=new e(Map.ResourcePath+"/images/map/address-marker.svg",25,25),n=null,o=new h(a.spatialReference),p=new i(i.STYLE_SOLID,new f([255,0,0]),3),q="";o.addPath([a,b]);var r=l.webMercatorToGeographic(o);Map.DetailRecordAddress=c,Map.DetailRecordAddressLineDistance=r,q=Map.DetailRecordAddressGetInfoWindowContent(),n=new g("Search Location",q),Map.CurrentDetailRecordAddressGraphic=new d(a,m,null,n),Map.CurrentDetailRecordLineDistanceGraphic=new d(o,p),Map.SpatialFilterExecuted=!1,b.x<a.x?Map.MainMap.centerAt(a).then(function(){var b=Map.MainMap.getZoom();b>14?Map.MainMap.setZoom(b-1).then(function(){Map.MainMap.infoWindow.setTitle("Search Location"),Map.MainMap.infoWindow.setContent(q),Map.MainMap.infoWindow.resize(270,300),Map.MainMap.infoWindow.show(a)}):(Map.MainMap.infoWindow.setTitle("Search Location"),Map.MainMap.infoWindow.setContent(q),Map.MainMap.infoWindow.resize(270,300),Map.MainMap.infoWindow.show(a))}):Map.MainMap.setExtent(o.getExtent().expand(2.5)).then(function(){Map.MainMap.infoWindow.setTitle("Search Location"),Map.MainMap.infoWindow.setContent(q),Map.MainMap.infoWindow.resize(270,300),Map.MainMap.infoWindow.show(a)})})},Map.DetailRecordAddressGetInfoWindowContent=function(){var a=0,b="",c=null,d="",e="",f="",g="",h="";return require(["esri/geometry/geodesicUtils","esri/units"],function(b,c){switch(Map.DetailRecordAddressLineDistanceUnit){case"mile":d="selected",a=b.geodesicLengths([Map.DetailRecordAddressLineDistance],c.MILES)[0].toFixed(2),h="miles";break;case"feet":e="selected",a=b.geodesicLengths([Map.DetailRecordAddressLineDistance],c.FEET)[0].toFixed(2),h="feet";break;case"kilometer":f="selected",a=b.geodesicLengths([Map.DetailRecordAddressLineDistance],c.KILOMETERS)[0].toFixed(2),h="kilometers";break;case"meter":g="selected",a=b.geodesicLengths([Map.DetailRecordAddressLineDistance],c.METERS)[0].toFixed(2),h="meters"}}),b='<span style="font-weight:bold">'+Map.DetailRecordAddress+'</span><br><p style="color:#4d4d4d">These points are '+a+" "+h+' apart</p><br><table><tr><td><a href="javascript:void(0)" style="font-weight:bold; font-size:12px" onclick="Map.RemoveDetailRecordDistanceGraphic()">Remove Line</a></td><td><select onchange="Map.DetailRecordAddressDistanceUnitChange(this.options[this.selectedIndex].value)" style="margin-left:30px"><option value="mile" '+d+'>Miles</option><option value="feet" '+e+'>Feet</option><option value="kilometer" '+f+'>Kilometers</option><option value="meter" '+g+">Meters</option></select></td></tr></table>"},Map.DetailRecordAddressDistanceUnitChange=function(a){var b="";Map.DetailRecordAddressLineDistanceUnit=a,b=Map.DetailRecordAddressGetInfoWindowContent(),Map.MainMap.infoWindow.setContent(b)},Map.RemoveDetailRecordDistanceGraphic=function(){null!=Map.CurrentDetailRecordAddressGraphic&&(Map.MainMap.graphics.remove(Map.CurrentDetailRecordAddressGraphic),Map.MainMap.graphics.remove(Map.CurrentDetailRecordLineDistanceGraphic),Map.CurrentDetailRecordAddressGraphic=null,Map.CurrentDetailRecordLineDistanceGraphic=null,Map.MainMap.infoWindow.hide())},Map.CurrentLocationGraphic=null,Map.CreateCurrentLocationGraphic=function(a){require(["esri/graphic","esri/symbols/PictureMarkerSymbol","esri/Color"],function(b,c,d){var e=new c(Map.ResourcePath+"/images/map/marker/"+MapSettings.MyLocationImageName,25,25);e.xoffset=MapSettings.MyLocationOffsetX,e.yoffset=MapSettings.MyLocationOffsetY,Map.CurrentLocationGraphic=new b(a,e,null,null),Map.RemoveAddressGraphic(),null!=Map.CurrentDetailRecordAddressGraphic&&(Map.MainMap.graphics.remove(Map.CurrentDetailRecordAddressGraphic),Map.MainMap.graphics.remove(Map.CurrentDetailRecordLineDistanceGraphic),Map.CurrentDetailRecordAddressGraphic=null,Map.CurrentDetailRecordLineDistanceGraphic=null),Map.MainMap.setScale(MapSettings.MyLocationScale),Map.MainMap.centerAt(a)})},Map.RemoveAddressGraphic=function(){null!=Map.CurrentAddressGraphic&&(Map.ResultPinGraphicsLayer.remove(Map.CurrentAddressGraphic),Map.CurrentAddressGraphic=null,Map.MainMap.infoWindow.hide())},Map.MapClicked=function(a){return Map.MeasureDistanceEnabled?void Map.UpdateMeasureDistance(a.mapPoint):(Map.ClearMeasureDistanceGraphic(),void(null!=a.graphic&&null==a.graphic.geometry.radius||(Map.TogglePinGraphic(!0),Map.ClearOrganizationSelection(),2==MapSettings.MapType&&Map.EnableMobileMainMenu(),$.slidebars.active("right")&&$.slidebars.toggle("right"),Map.OrganizationDetailOpen=!1)))},Map.ClearMeasureDistanceGraphic=function(){null!=Map.MeasureDistanceGraphic&&(null!=$("#measurementValue")[0]&&($("#measurementValue")[0].innerHTML="&nbsp;"),null!=$("#measurementInfo")[0]&&($("#measurementInfo")[0].style.visibility="hidden"),Map.MainMap.graphics.clear(),Map.MeasureDistanceLine=null,Map.MeasureDistanceGraphic=null)},Map.MapDoubleClicked=function(a){null!=Map.ToolBar&&(Map.ToolBar.finishDrawing(),Map.ToolBar.deactivate(),Map.ToolBar=null,Map.MeasureDistanceEnabled=!1,require(["esri/Color","esri/symbols/SimpleLineSymbol","esri/graphic"],function(a,b,c){var d=new a([0,140,245]),e=new b(b.STYLE_SOLID,d,3);Map.MeasureDistanceGraphic=new c(Map.MeasureDistanceLine,e),Map.MainMap.graphics.add(Map.MeasureDistanceGraphic)}),$(".distanceTool").removeClass("distanceToolActive"),Map.MainMap.setMapCursor("auto"))},Map.MouseUp=function(a){1==Map.PinLabelSelected&&0==Map.PinLabelConflictSelect&&(Map.ResultLabelGraphicsLayer.add(Map.PreviouslySelectedLabel),Map.ResultSelectionGraphicsLayer.add(Map.PreviouslySelectedSelection)),Map.PinLabelSelected=!1,Map.PinLabelConflictSelect=!1},Map.MapMouseMove=function(a){Map.MeasureDistanceEnabled&&Map.MeasurePreview(a.mapPoint)},Map.ToggleDetailRecordLoader=function(a){1==a?null!=$("#recordDetailLoader")[0]&&($("#recordDetailLoader")[0].style.visibility="visible"):null!=$("#recordDetailLoader")[0]&&($("#recordDetailLoader")[0].style.visibility="hidden")},Map.GetDetailRecordInformation=function(a,b){if("undefined"!=a.attributes&&null!=a.attributes){var c=a.attributes.IDs,d="/map/GetDetailRecordInfo",e=a.geometry.x,f=a.geometry.y,g=0,h=0,i="";try{if(require(["esri/geometry/webMercatorUtils"],function(a){var b=a.xyToLngLat(e,f);h=b[0],g=b[1]}),Map.CloseFilterPanel(),"1_"==c[0].substring(0,2)){if(!Map.OffenderDisclaimerAccepted)return void Map.LoadOffenderDisclaimerModal("detailrecord");$.slidebars.open("Error500.html")}else $.slidebars.open("Error500.html");Map.ToggleDetailRecordLoader(!0),i=JSON.stringify(MapSettings.WhatAttributeCategories),Map.OrganizationDetailOpen=!1,$.ajax({url:d,type:"POST",data:{IDs:c,x:e,y:f,picx:g,picy:h,suggestNumCharacters:MapSettings.NumSearchCharacters,whatAttributeCategories:i,offenderDisclaimerAccepted:Map.OffenderDisclaimerAccepted,selPin:b},success:function(a){null!=a&&($("#divRightPanel").html(a),"mobile"==$("#mapType").val()?(Map.LoadMobileSearchMenus(),$("#divMainMenu").hide(),$("#divRightPanel").show()):($("#txtDetailRecordLocationSearch").hide(),$("#locationSearchRecordDetail").show(),EventTracking.MapDetailsOpenPanel()),Map.DetailRecordID=$("#detailRecordID").val(),Map.CloseNavTrigger(),Map.NavBarOpen&&Map.NavTriggerClick()),Map.ToggleDetailRecordLoader(!1)},error:function(a,b,c){Map.ToggleDetailRecordLoader(!1),Map.LoadErrorModal("Get Detail Record Info - "+c,5,851e4)}})}catch(j){}}},Map.BrowseDetailRecordInformation=function(a,b,c){var d="/map/BrowseDetailRecordInfo",e="";Map.ToggleDetailRecordLoader(!0),e=JSON.stringify(a),$.ajax({url:d,type:"POST",data:{model:e,browseType:b,ID:c,offenderDisclaimerAccepted:Map.OffenderDisclaimerAccepted},success:function(a){null!=a&&($("#divRightPanel").html(a),Map.DetailRecordID=$("#detailRecordID").val()),2==MapSettings.MapType&&($("#divMainMenu").hide(),$("#divRightPanel").show()),Map.ToggleDetailRecordLoader(!1)},error:function(a,b,c){Map.ToggleDetailRecordLoader(!1),Map.LoadErrorModal("Browse Detail Record Info - "+c,5,851e4)}})},Map.ZoomToDetailRecord=function(a){for(var b=Map.ResultPinGraphicsLayer.graphics,c=MapSettings.ZoomScale,d=0;d<b.length;d++){var e=b[d];if(null!=e.attributes)for(var f=0;f<e.attributes.IDs.length;f++)if(e.attributes.IDs[f]==a){var g=e.geometry;Map.ZoomToRecord=!0,Map.MainMap.setScale(c);try{Map.MainMap.centerAt(g)}catch(h){}return}}EventTracking.MapDetailsZoomToClicked()},Map.ManualMapChange=!1,Map.MapExtentChanged=function(a){if(Map.WhenPanelInitialized){if(Map.IsRightPanelPinned&&!Map.IgnoreExtentChanged)Map.PinRightPanel();else if(Map.IgnoreExtentChanged)return void(Map.IgnoreExtentChanged=!1);Map.ZoomToRecord&&(Map.ZoomToRecord=!1),""==$("#divScaleDisplay")[0].style.visibility&&($("#lblScale")[0].innerText="1:"+parseInt(Map.MainMap.getScale())),Map.InitiateSearchRequest(a)}},Map.WindowResized=function(){Map.NavLayoutCheck()},Map.NavLayoutCheck=function(){var a=window.innerWidth;Map.NavBarOpen?$("#sb-site").css("width",a-200+"px"):$("#sb-site").css("width","auto")},Map.NavTriggerClick=function(){Map.NavBarOpen=!Map.NavBarOpen,Map.NavLayoutCheck(),$.slidebars.active("right")?(Map.IsRightPanelPinned&&Map.ToggleRightPanelPinMode(),$.slidebars.toggle("right")):EventTracking.MapHamburgerHelperSelected()},Map.CloseNavTrigger=function(){null!=$("#nav-trigger:checked")[0]&&($("#nav-trigger:checked")[0].checked=!1)},Map.LocationSearchKeyUp=function(){""!=$("#locationSearch").val()?$(".clearSearch").show():$(".clearSearch").hide()},Map.LocationSearchRecordDetailKeyUp=function(){""!=$("#locationSearchRecordDetail").val()?$("#spClearSearchDetailRecord").css("visibility","visible"):$("#spClearSearchDetailRecord").css("visibility","hidden")},Map.LocationSearchOrganizationKeyUp=function(){""!=$("#locationSearchOrganization").val()?$("#spClearSearchOrganization").css("visibility","visible"):$("#spClearSearchOrganization").css("visibility","hidden")},Map.LocationSuggestParameters=function(a,b){if(a=null,""==b||void 0==b)return void $(".k-loading").css("visibility","hidden")},Map.LocationSuggestParameters=function(a){Map.SelectedLocationSuggestion=null;var b=a.filter.filters[0].value,c=null,d=0,e=0,f=[];return $(".k-loading").css("visibility",""),null!=Map.MainMap.extent&&(c=Map.MainMap.extent.getCenter(),d=c.x,e=c.y),f={text:b,x:d,y:e},""!=b&&void 0!=b||$(".k-loading").css("visibility","hidden"),f},Map.LocationSuggestParametersWherePanel=function(a){Map.SelectedLocationSuggestion=null;var b=a.filter.filters[0].value,c=null,d=0,e=0,f=[];return $(".k-loading").css("visibility",""),null!=Map.MainMap.extent&&(c=Map.MainMap.extent.getCenter(),d=c.x,e=c.y),f={text:b,x:d,y:e},""!=b&&void 0!=b||$(".k-loading").css("visibility","hidden"),f},Map.LocationSuggestParametersRecordDetail=function(a){Map.SelectedLocationSuggestion=null;var b=a.filter.filters[0].value,c=null,d=0,e=0,f=[];return $(".k-loading").css("visibility",""),null!=Map.MainMap.extent&&(c=Map.MainMap.extent.getCenter(),d=c.x,e=c.y),f={text:b,x:d,y:e},""!=b&&void 0!=b||$(".k-loading").css("visibility","hidden"),f},Map.SelectedLocationSuggestion=null,Map.LocationSelectionFlag=!1,Map.LocationSuggestSelected=function(a){var b=this.dataItem(a.item.index());Map.SelectedLocationSuggestion=b,$("#topToolbar .clearSearch").show(),Map.LocationSelectionFlag=!0,Map.GeocodeSearchAddress()},Map.LocationSearchTextChanged=function(){Map.LocationSelectionFlag||(Map.SelectedLocationSuggestion=null),Map.LocationSelectionFlag=!1},Map.SelectedLocationSuggestionWherePanel=null,Map.LocationSelectionFlagWherePanel=!1,Map.LocationSuggestSelectedWherePanel=function(a){var b=this.dataItem(a.item.index());Map.SelectedLocationSuggestionWherePanel=b,Map.LocationSelectionFlagWherePanel=!0,2==MapSettings.MapType&&Map.ApplySpatialFilter()},Map.LocationSearchTextChangedWherePanel=function(){Map.LocationSelectionFlagWherePanel||(Map.SelectedLocationSuggestionWherePanel=null),Map.LocationSelectionFlagWherePanel=!1},Map.SelectedLocationSuggestionRecordDetail=null,Map.LocationSelectionFlagRecordDetail=!1,Map.LocationSuggestSelectedRecordDetail=function(a){var b=this.dataItem(a.item.index());Map.SelectedLocationSuggestionRecordDetail=b,Map.LocationSelectionFlagRecordDetail=!0,Map.GeocodeDetailRecordLocation($("#detailRecordX").val(),$("#detailRecordY").val())},Map.ClearAddressSearch=function(){$("#locationSearch").val(""),Map.SelectedLocationSuggestion=null,Map.RemoveAddressGraphic(),$(".clearSearch").hide()},Map.ClearAddressSearchRecordDetail=function(){$("#locationSearchRecordDetail").val(""),Map.SelectedLocationSuggestionRecordDetail=null,$(".k-loading").css("visibility","hidden"),$("#spClearSearchDetailRecord").css("visibility","hidden")},Map.ClearAddressSearchOrganization=function(){$("#locationSearchOrganization").val(""),Map.SelectedLocationSuggestionRecordDetail=null,$(".k-loading").css("visibility","hidden"),$("#spClearSearchOrganization").css("visibility","hidden")},Map.LocationSearchTextChangedWherePanel=function(){Map.LocationSelectionFlagWherePanel||(Map.SelectedLocationSuggestionWherePanel=null),Map.LocationSelectionFlagWherePanel=!1},Map.LocationSearchRecordDetailTextChanged=function(){Map.LocationSelectionFlagRecordDetail||(Map.SelectedLocationSuggestionRecordDetail=null),Map.LocationSelectionFlagRecordDetail=!1},Map.LocationSuggestOpen=function(){$("div.k-list-container").width("600px")},Map.GoToSelectedLocation=function(a){if(""==a)return $("#locationSearch").val(""),void $("#locationSearchSecondary").val("");var b="";try{b=$.parseJSON(a)}catch(c){return}if(0==b.locations.length)return $("#locationSearch").val(""),void $("#locationSearchSecondary").val("");var d=b.locations[0].feature.geometry.x,e=b.locations[0].feature.geometry.y,f=b.locations[0].feature.attributes.Place_addr;""==f&&(f=b.locations[0].feature.attributes.Match_addr),null!=Map.SelectedLocationSuggestion&&(f=Map.SelectedLocationSuggestion.Text),require(["esri/geometry/Point"],function(a){var b=new a(d,e);Map.ClearSpatialFilter(),Map.CreateAddressGraphic(b,f,"locationsearch")}),Map.PreviouslySelectedPin=null,$.slidebars.active("right")&&$.slidebars.toggle("right"),2==MapSettings.MapType&&Map.EnableMobileMainMenu()},Map.GoToSelectedLocationWherePanel=function(a){var b="";try{b=$.parseJSON(a)}catch(c){return}var d=b.locations[0].feature.geometry.x,e=b.locations[0].feature.geometry.y,f=b.locations[0].feature.attributes.Place_addr,g="";return null!=$("#whereBufferDistances")[0]&&(g=$("#whereBufferDistances")[0].value),Map.RemoveAddressGraphic(),null!=Map.CurrentBufferGraphic&&(Map.ResultPinGraphicsLayer.remove(Map.CurrentBufferGraphic),Map.CurrentBufferGraphic=null),"0"==g?void Map.InitiateSearchRequest():(f=null!=Map.SelectedLocationSuggestionWherePanel?Map.SelectedLocationSuggestionWherePanel.Text:$("#locationSearchWherePanel").val(),void require(["esri/geometry/Point"],function(a){var b=new a(d,e);Map.CreateAddressGraphic(b,f,"wherepanel"),setTimeout(Map.CreateBufferGraphic(b),2e3)}))},Map.GoToSelectedLocationDetailRecord=function(a,b,c,d){if(""==a)return void $("#locationSearchRecordDetail").val("");var e="";try{e=$.parseJSON(a)}catch(f){return}if(0==e.locations.length)return void $("#locationSearchRecordDetail").val("");var g=e.locations[0].feature.geometry.x,h=e.locations[0].feature.geometry.y,i=e.locations[0].feature.attributes.Place_addr,j=null;""!=i&&null!=i&&(d=i),null!=Map.SelectedLocationSuggestionRecordDetail&&(i=Map.SelectedLocationSuggestionRecordDetail.Text),require(["esri/geometry/Point","esri/geometry/webMercatorUtils"],function(a,e){var f=e.project(new a(g,h),Map.MainMap),i=new a(b,c);i.spatialReference=f.spatialReference,Map.CreateDetailRecordAddressGraphic(f,i,d)})},Map.GoToSelectedLocationOrganization=function(a,b,c,d){var e="";try{$.parseJSON(a)}catch(f){return}if(0==e.locations.length)return void $("#locationSearchOrganization").val("");var g=e.locations[0].feature.geometry.x,h=e.locations[0].feature.geometry.y,i=e.locations[0].feature.attributes.Place_addr,j=null;""!=i&&null!=i&&(d=i),null!=Map.SelectedLocationSuggestionRecordDetail&&(i=Map.SelectedLocationSuggestionRecordDetail.Text),require(["esri/geometry/Point","esri/geometry/webMercatorUtils"],function(a,e){var f=e.project(new a(g,h),Map.MainMap),i=new a(b,c);i.spatialReference=f.spatialReference,Map.CreateDetailRecordAddressGraphic(f,i,d)})},Map.CurrentBufferGraphic=null,Map.CreateBufferGraphic=function(a){require(["esri/geometry/Circle","esri/graphic","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/Color","esri/units","esri/geometry/Point","esri/geometry/webMercatorUtils"],function(b,c,d,e,f,g,h,i){var j="0",k=MapSettings.QueryGeometry.co,l=MapSettings.QueryGeometry.ol.st,m=MapSettings.QueryGeometry.ol.co,n=MapSettings.QueryGeometry.ol.wd,o=null;switch(l){case 0:o=e.STYLE_DASH;break;case 1:o=e.STYLE_DASHDOT;break;case 2:o=e.STYLE_DASHDOTDOT;break;case 3:o=e.STYLE_DOT;break;case 4:o=e.STYLE_NULL;break;case 5:o=e.STYLE_SOLID;break;default:o=e.STYLE_SOLID}null!=$("#whereBufferDistances")[0]&&(j=$("#whereBufferDistances")[0].value);var p=i.geographicToWebMercator(a);Map.CenterPoint=p;var q=new b({center:p,radius:j,radiusUnit:g.METERS,geodesic:!0}),r=new e(o,new f(m),n),s=new d(d.STYLE_SOLID,r,new f([255,255,255,.1])),t=2,u=q.getExtent().expand(t);Map.CurrentBufferGraphic=new c(q,s),Map.MainMap.setExtent(u)})},Map.GeocodeSearchAddress=function(a){var b="";if(b=null!=$("#locationSearch")[0]?$("#locationSearch").val():a,null!=Map.SelectedLocationSuggestion||""!=b){null!=Map.SelectedLocationSuggestion&&(b=Map.SelectedLocationSuggestion.Text),b=b.replace(/[^\w\s\.,]/gi,"");var c="";
(null!=Map.SelectedLocationSuggestion&&"0"==Map.SelectedLocationSuggestion.Source||""!=b)&&(c=ScriptHelper.GetBaseUrl()+"/map/GeocodeLocation"),""!=c&&(null!=Map.SelectedLocationSuggestion?$.ajax({url:c,type:"POST",data:{location:b,id:Map.SelectedLocationSuggestion.MagicKey,iscollection:Map.SelectedLocationSuggestion.IsCollection,maxlocations:MapSettings.MaxNumSuggestions},success:function(a){return null!=a.sessionend?void Map.EndSession(a):(Map.ClearAgencyFilter(),Map.SearchByLocation=!0,void Map.GoToSelectedLocation(a))},error:function(a,b,c){Map.LoadErrorModal("Geocode Search Address - "+c,5,851e4)}}):$.ajax({url:c,type:"POST",data:{location:b,id:"",iscollection:!1,maxlocations:MapSettings.MaxNumSuggestions},success:function(a){Map.ClearAgencyFilter(),Map.SearchByLocation=!0,Map.GoToSelectedLocation(a)},error:function(a,b,c){Map.LoadErrorModal("Geocode Search Address - "+c,5,851e4)}}))}},Map.GeocodeSearchAddressWherePanel=function(a){var b=null,c="";if(c=null==a?2==MapSettings.MapType?$("#txtWhereLocationSearch").val():$("#locationSearchWherePanel").val():a,null==Map.SelectedLocationSuggestionWherePanel&&""==c)return void Map.ClearSpatialFilter();null!=Map.SelectedLocationSuggestionWherePanel&&(c=Map.SelectedLocationSuggestionWherePanel.Text),c=c.replace(/[^\w\s\.,]/gi,"");var d="";return(null!=Map.SelectedLocationSuggestionWherePanel&&"0"==Map.SelectedLocationSuggestionWherePanel.Source||""!=c)&&(d=ScriptHelper.GetBaseUrl()+"/map/GeocodeLocation"),""!=d?(null!=Map.SelectedLocationSuggestionWherePanel?$.ajax({url:d,type:"POST",data:{location:c,id:Map.SelectedLocationSuggestionWherePanel.MagicKey,iscollection:Map.SelectedLocationSuggestionWherePanel.IsCollection,maxlocations:MapSettings.MaxNumSuggestions},success:function(a){if(null!=a.sessionend)return void Map.EndSession(a);var b="";try{b=$.parseJSON(a)}catch(c){return}var d=0,e=0;require(["esri/geometry/webMercatorUtils","esri/geometry/Point","esri/SpatialReference"],function(a,c,f){var g=new c(b.locations[0].feature.geometry.x,b.locations[0].feature.geometry.y,new f({wkid:102100})),h=a.geographicToWebMercator(g);d=h.x,e=h.y}),Map.AddressFilterObj=Map.CreateAddressSpatialFilterObject(b.locations[0].name,d,e,$("#whereBufferDistances").val()),Map.GoToSelectedLocationWherePanel(a)},error:function(a,b,c){Map.LoadErrorModal("Geocode Search Address Where Panel - "+c,5,851e4)}}):$.ajax({url:d,type:"POST",data:{location:c,id:"",iscollection:!1,maxlocations:MapSettings.MaxNumSuggestions},success:function(a){var b="";try{b=$.parseJSON(a)}catch(c){return}var d=0,e=0;require(["esri/geometry/webMercatorUtils","esri/geometry/Point","esri/SpatialReference"],function(a,c,f){var g=new c(b.locations[0].feature.geometry.x,b.locations[0].feature.geometry.y,new f({wkid:102100})),h=a.geographicToWebMercator(g);d=h.x,e=h.y}),Map.AddressFilterObj=Map.CreateAddressSpatialFilterObject($("#locationSearchWherePanel").val(),d,e,$("#whereBufferDistances").val()),Map.GoToSelectedLocationWherePanel(a)},error:function(a,b,c){Map.LoadErrorModal("Geocode Search Address Where Panel - "+c,5,851e4)}}),b):void 0},Map.GeocodeDetailRecordLocation=function(a,b,c){var d="";d=null!=Map.SelectedLocationSuggestionRecordDetail?Map.SelectedLocationSuggestionRecordDetail.Text:""!=$("#locationSearchRecordDetail").val()?$("#locationSearchRecordDetail").val():c;var e="",f="";d=d.replace(/[^\w\s\.,]/gi,""),e=ScriptHelper.GetBaseUrl()+"/map/GeocodeLocation",""!=e&&(null!=Map.SelectedLocationSuggestionRecordDetail&&(f=Map.SelectedLocationSuggestionRecordDetail.MagicKey),$.ajax({url:e,type:"POST",data:{location:d,id:f,iscollection:!1,maxlocations:MapSettings.MaxNumSuggestions},success:function(c){return null!=c.sessionend?void Map.EndSession(c):void Map.GoToSelectedLocationDetailRecord(c,a,b,d)},error:function(a,b,c){Map.LoadErrorModal("Geocode Detail Record Location - "+c,5,851e4)}}),$(".k-loading").css("visibility","hidden"),EventTracking.MapDetailsHowCloseGo())},Map.GeocodeOrganizationLocation=function(a,b,c){var d="";d="mobile"==$("#mapType").val()?null!=$("#txtOrganizationLocationSearch")[0]?$("#txtOrganizationLocationSearch").val():c:null!=$("#locationSearchOrganization")[0]?$("#locationSearchOrganization").val():c,d=d.replace(/[^\w\s\.,]/gi,"");var e="";e=ScriptHelper.GetBaseUrl()+"/map/GeocodeLocation",""!=e&&($.ajax({url:e,type:"POST",data:{location:d,id:Map.SelectedLocationSuggestionRecordDetail.MagicKey,iscollection:!1,maxlocations:MapSettings.MaxNumSuggestions},success:function(c){return null!=c.sessionend?void Map.EndSession(c):void Map.GoToSelectedLocationOrganization(c,a,b,d)},error:function(a,b,c){Map.LoadErrorModal("Geocode Detail Record Location - "+c,5,851e4)}}),$(".k-loading").css("visibility","hidden"))},Map.SearchRequestStack=[],Map.SearchRequestCounter=0,Map.ShowStatusBar=function(a,b){switch(a){case"maxrecords":$("#lblMaxRecordCount")[0].innerHTML=b,$("#divStatusBarZoomIn")[0].style.visibility="hidden",$("#divStatusBarNoDataProvided")[0].style.visibility="hidden",$("#divStatusBarNoDataFound")[0].style.visibility="hidden",$("#divStatusBarMissingRecords")[0].style.visibility="hidden",null!=$("#divStatusBarRecordCountAndDate")[0]&&($("#divStatusBarRecordCountAndDate")[0].style.visibility="hidden"),null!=$("#divStatusBarSexOffenderData")[0]&&($("#divStatusBarSexOffenderData")[0].style.visibility="hidden"),null!=$("#divStatusBarAgencyFilter")[0]&&($("#divStatusBarAgencyFilter")[0].style.visibility="hidden"),$("#divStatusBarMaxRecords")[0].style.visibility="visible",Map.SetStatusBarPosition(a,$("#divStatusBarMaxRecords")[0]);break;case"zoomin":$("#divStatusBarMaxRecords")[0].style.visibility="hidden",$("#divStatusBarNoDataProvided")[0].style.visibility="hidden",$("#divStatusBarNoDataFound")[0].style.visibility="hidden",$("#divStatusBarMissingRecords")[0].style.visibility="hidden",null!=$("#divStatusBarRecordCountAndDate")[0]&&($("#divStatusBarRecordCountAndDate")[0].style.visibility="hidden"),null!=$("#divStatusBarSexOffenderData")[0]&&($("#divStatusBarSexOffenderData")[0].style.visibility="hidden"),null!=$("#divStatusBarAgencyFilter")[0]&&($("#divStatusBarAgencyFilter")[0].style.visibility="hidden"),$("#divStatusBarZoomIn")[0].style.visibility="visible",Map.SetStatusBarPosition(a,$("#divStatusBarZoomIn")[0]);break;case"missingrecords":$("#divStatusBarMaxRecords")[0].style.visibility="hidden",$("#divStatusBarZoomIn")[0].style.visibility="visible",$("#divStatusBarNoDataProvided")[0].style.visibility="hidden",$("#divStatusBarNoDataFound")[0].style.visibility="hidden",null!=$("#divStatusBarRecordCountAndDate")[0]&&($("#divStatusBarRecordCountAndDate")[0].style.visibility="hidden"),null!=$("#divStatusBarSexOffenderData")[0]&&($("#divStatusBarSexOffenderData")[0].style.visibility="hidden"),null!=$("#divStatusBarAgencyFilter")[0]&&($("#divStatusBarAgencyFilter")[0].style.visibility="hidden"),$("#divStatusBarMissingRecords")[0].style.visibility="visible",Map.SetStatusBarPosition(a,$("#divStatusBarMissingRecords")[0]);break;case"nodataprovided":$("#divStatusBarMaxRecords")[0].style.visibility="hidden",$("#divStatusBarZoomIn")[0].style.visibility="hidden",$("#divStatusBarNoDataFound")[0].style.visibility="hidden",$("#divStatusBarMissingRecords")[0].style.visibility="hidden",null!=$("#divStatusBarRecordCountAndDate")[0]&&($("#divStatusBarRecordCountAndDate")[0].style.visibility="hidden"),null!=$("#divStatusBarSexOffenderData")[0]&&($("#divStatusBarSexOffenderData")[0].style.visibility="hidden"),null!=$("#divStatusBarAgencyFilter")[0]&&($("#divStatusBarAgencyFilter")[0].style.visibility="hidden"),$("#divStatusBarNoDataProvided")[0].style.visibility="visible",Map.SetStatusBarPosition(a,$("#divStatusBarNoDataProvided")[0]);break;case"nodatafound":$("#divStatusBarMaxRecords")[0].style.visibility="hidden",$("#divStatusBarZoomIn")[0].style.visibility="hidden",$("#divStatusBarNoDataProvided")[0].style.visibility="hidden",$("#divStatusBarMissingRecords")[0].style.visibility="hidden",null!=$("#divStatusBarRecordCountAndDate")[0]&&($("#divStatusBarRecordCountAndDate")[0].style.visibility="hidden"),null!=$("#divStatusBarSexOffenderData")[0]&&($("#divStatusBarSexOffenderData")[0].style.visibility="hidden"),$("#divStatusBarNoDataFound")[0].style.visibility="visible",Map.SetStatusBarPosition(a,$("#divStatusBarNoDataFound")[0]);break;case"agencyfilter":if($("#divStatusBarMaxRecords")[0].style.visibility="hidden",$("#divStatusBarZoomIn")[0].style.visibility="hidden",$("#divStatusBarNoDataProvided")[0].style.visibility="hidden",$("#divStatusBarMissingRecords")[0].style.visibility="hidden",null!=$("#divStatusBarAgencyFilter")[0]&&($("#divStatusBarAgencyFilter")[0].style.visibility="visible",$("#divStatusBarAgencyFilter")[0].style.top=Map.SetStatusBarPosition(a,$("#divStatusBarAgencyFilter")[0])),1==Map.HasReachedMaxRecordCount){for(var c=0;c<Map.AgenciesByExtent.length;c++)if(Map.AgenciesByExtent[c].id==Map.AgencyFilter[0]){$("#statusAgencyName").html(Map.AgenciesByExtent[c].name);break}}else for(var d=JSON.parse(Map.VisibleAgencies),c=0;c<d.length;c++)if(d[c].id==Map.AgencyFilter[0]){$("#statusAgencyName").html(d[c].na);break}break;case"clientlogin":Map.SetStatusBarPosition(a,$("#divClientLogIn")[0]),$("#divClientLogIn")[0].style.visibility="visible";break;case"recordcountanddate":$("#lblRecordCount")[0].innerHTML=b,$("#divStatusBarRecordCountAndDate")[0].style.visibility="visible",Map.SetStatusBarPosition(a,$("#divStatusBarRecordCountAndDate")[0]);break;case"sexoffenderdata":$("#divStatusBarSexOffenderData")[0].style.visibility="visible",Map.SetStatusBarPosition(a,$("#divStatusBarSexOffenderData")[0])}0==$("#displayReports").hasClass("viewReportToolbarDisabled")&&($("#displayReports").addClass("viewReportToolbarDisabled"),$("#displayReports").attr("onclick","javascript:void(0)")),0==$("#reportCharts").hasClass("viewChartsToolbarDisabled")&&($("#reportCharts").addClass("viewChartsToolbarDisabled"),$("#reportCharts").attr("onclick","javascript:void(0)"))},Map.SetStatusBarPosition=function(a,b){var c=0,d=new Array(9),e=!1,f=-1,g=!1,h=-1,i=!1,j=-1,k=!1,l=-1,m=!1,n=-1,o=!1,p=-1,q=!1,r=-1,s=!1,t=-1,u=!1,v=-1,w=!1;if(1==MapSettings.MapType?(d[0]="100px",d[1]="130px",d[2]="160px",d[3]="190px",d[4]="220px",d[5]="250px",d[6]="280px",d[7]="310px",d[8]="340px"):2==MapSettings.MapType&&(d[0]="60px",d[1]="90px",d[2]="120px",d[3]="150px",d[4]="180px",d[5]="210px",d[6]="240px",d[7]="270px",d[8]="300px"),"visible"!=$("#divClientLogIn").css("visibility")&&""!=$("#divClientLogIn").css("visibility")||(e=!0,f=d.indexOf($("#divClientLogIn").css("top"))),"visible"!=$("#divStatusBarAgencyFilter").css("visibility")&&""!=$("#divStatusBarAgencyFilter").css("visibility")||(g=!0,h=d.indexOf($("#divStatusBarAgencyFilter").css("top"))),"visible"!=$("#divStatusBarRecordCountAndDate").css("visibility")&&""!=$("#divStatusBarRecordCountAndDate").css("visibility")||(i=!0,j=d.indexOf($("#divStatusBarRecordCountAndDate").css("top"))),"visible"!=$("#divStatusBarSexOffenderData").css("visibility")&&""!=$("#divStatusBarSexOffenderData").css("visibility")||(k=!0,l=d.indexOf($("#divStatusBarSexOffenderData").css("top"))),"visible"!=$("#divStatusBarNoDataFound").css("visibility")&&""!=$("#divStatusBarNoDataFound").css("visibility")||(m=!0,n=d.indexOf($("#divStatusBarNoDataFound").css("top"))),"visible"!=$("#divStatusBarMaxRecords").css("visibility")&&""!=$("#divStatusBarMaxRecords").css("visibility")||(o=!0,p=d.indexOf($("#divStatusBarMaxRecords").css("top"))),"visible"!=$("#divStatusBarZoomIn").css("visibility")&&""!=$("#divStatusBarZoomIn").css("visibility")||(u=!0,v=d.indexOf($("#divStatusBarZoomIn").css("top"))),"visible"!=$("#divStatusBarNoDataProvided").css("visibility")&&""!=$("#divStatusBarNoDataProvided").css("visibility")||(s=!0,t=d.indexOf($("#divStatusBarNoDataProvided").css("top"))),"visible"!=$("#divStatusBarMissingRecords").css("visibility")&&""!=$("#divStatusBarMissingRecords").css("visibility")||(q=!0,r=d.indexOf($("#divStatusBarMissingRecords").css("top"))),"visible"==b.style.visibility&&(w=!0),w)for(var x=!1,y=!1,z=!1,A=!1,B=!1,C=!1,D=!1,E=!1,F=!1,G=0;G<d.length;G++)!e||x?!g||y?!i||z?!k||A?!m||B?!o||C?!u||D?!s||E?!q||F||($("#divStatusBarMissingRecords").css("top",d[G]),F=!0):($("#divStatusBarNoDataProvided").css("top",d[G]),E=!0):($("#divStatusBarZoomIn").css("top",d[G]),D=!0):($("#divStatusBarMaxRecords").css("top",d[G]),C=!0):($("#divStatusBarNoDataFound").css("top",d[G]),B=!0):($("#divStatusBarSexOffenderData").css("top",d[G]),A=!0):($("#divStatusBarRecordCountAndDate").css("top",d[G]),z=!0):($("#divStatusBarAgencyFilter").css("top",d[G]),y=!0):($("#divClientLogIn").css("top",d[G]),x=!0);else{e&&(d[f]=""),g&&(d[h]=""),i&&(d[j]=""),k&&(d[l]=""),m&&(d[n]=""),o&&(d[p]=""),u&&(d[v]=""),s&&(d[t]=""),q&&(d[r]="");for(var G=0;G<d.length;G++)if(""!=d[G]){b.style.top=d[G];break}}},Map.viewReportToolbarMouseOver=function(){0==$("#displayReports").hasClass("viewReportToolbarHover")&&$("#displayReports").addClass("viewReportToolbarHover")},Map.viewReportToolbarMouseOut=function(){$("#displayReports").removeClass("viewReportToolbarHover")},Map.viewChartsToolbarMouseOver=function(){0==$("#reportCharts").hasClass("viewChartsToolbarHover")&&$("#reportCharts").addClass("viewChartsToolbarHover")},Map.viewChartsToolbarMouseOut=function(){$("#reportCharts").removeClass("viewChartsToolbarHover")},Map.HideStatusBar=function(){$("#divStatusBarMaxRecords")[0].style.visibility="hidden",$("#divStatusBarZoomIn")[0].style.visibility="hidden",$("#divStatusBarNoDataProvided")[0].style.visibility="hidden",$("#divStatusBarNoDataFound")[0].style.visibility="hidden",$("#divStatusBarMissingRecords")[0].style.visibility="hidden",$("#displayReports").removeClass("viewReportToolbarDisabled"),$("#displayReports").attr("onclick","Map.OpenReport()"),$("#reportCharts").removeClass("viewChartsToolbarDisabled"),$("#reportCharts").attr("onclick","Map.OpenReport(true)")},Map.StatusBarZoomIn=function(){var a=MapSettings.ZoomMaxScale,b=Map.MainMap.extent.getCenter();Map.MainMap.setScale(a),Map.MainMap.centerAt(b)},Map.StatusBarZLZoomIn=function(){var a=Map.MainMap.getZoom(),b=Map.MainMap.extent.getCenter();Map.MainMap.centerAt(b),Map.MainMap.setZoom(a+1)},Map.BuildOrganizationGraphicsLayer=function(){var a=null;return require(["esri/layers/GraphicsLayer"],function(b){var c=Map.CreateOrganizationRenderer();a=new b({id:"OrganizationGraphics"}),a.setRenderer(c),a.on("mouse-up",Map.OrganizationGraphicMouseUp)}),a},Map.CreateOrganizationRenderer=function(){var a=null;return require(["esri/renderers/SimpleRenderer","esri/symbols/PictureMarkerSymbol"],function(b,c){var d=new c(Map.ResourcePath+"/images/map/marker/"+MapSettings.OrganizationSymbolInfo.sm["in"],47,35);d.xoffset=MapSettings.OrganizationSymbolInfo.sm.ox,d.yoffset=MapSettings.OrganizationSymbolInfo.sm.oy,a=new b(d)}),a},Map.BuildSelectionOrganizationGraphicsLayer=function(){var a=null;return require(["esri/layers/GraphicsLayer"],function(b){var c=Map.CreateSelectedOrganizationRenderer();a=new b({id:"SelectedOrganizationGraphics"}),a.setRenderer(c)}),a},Map.CreateSelectedOrganizationRenderer=function(){var a=null;return require(["esri/renderers/SimpleRenderer","esri/symbols/PictureMarkerSymbol"],function(b,c){var d=new c(Map.ResourcePath+"/images/map/marker/"+MapSettings.OrganizationSymbolInfo.ss["in"],50,50);d.xoffset=MapSettings.OrganizationSymbolInfo.ss.ox,d.yoffset=MapSettings.OrganizationSymbolInfo.ss.oy,a=new b(d)}),a},Map.OrganizationGraphicMouseUp=function(a){var b=a.graphic,c=Map.OrganizationGraphicsLayer.graphics,d=null,e=null,f=!1;if(null!=b.attributes&&!Map.MeasureDistanceEnabled&&0!=b.visible){for(var g=0;g<c.length;g++)if(null!=c[g].attributes){if(c[g].attributes.id==b.attributes.id){d=c[g],f=!0;break}if(1==f)break}null!=d&&Map.OpenOrganizationDetail(b.attributes.id,!1)}},Map.DisplaySelectedOrganizationGraphicsLayers=function(a){"undefined"!=a.attributes&&null!=a.attributes&&(null!=Map.PreviouslySelectedOrganizationGraphic&&Map.PreviouslySelectedOrganizationGraphic.show(),Map.PreviouslySelectedOrganizationGraphic=a,Map.OrganizationSelectionGraphicsLayer.clear(),require(["esri/geometry/Point","esri/graphic","esri/SpatialReference"],function(b,c,d){var e=new b(a.geometry.x,a.geometry.y,new d({wkid:102100}));selectiongraphic=new c(e,null,{id:a.attributes.id},null),Map.PreviouslySelectedOrganizationGraphic.hide(),Map.OrganizationSelectionGraphicsLayer.add(selectiongraphic)}))},Map.OpenOrganizationDetail=function(a,b){var c="/map/GetOrganizationDetail",d=!1,e=!1,f="";if(""==a||null==a)if(Map.AgencyFilter.length>0)a=Map.AgencyFilter[0],Map.DefaultAgencyID=a;else if(null!=Map.PreviouslySelectedOrganizationGraphic)a=Map.PreviouslySelectedOrganizationGraphic.attributes.id,Map.DefaultAgencyID=a;else if(Map.DefaultAgencyID>-1)a=Map.DefaultAgencyID;else{var g=JSON.parse(Map.VisibleAgencies);g.length>0&&(a=g[0].id,Map.DefaultAgencyID=a)}else Map.DefaultAgencyID=a;var h=Map.MainMap;require(["esri/geometry/Extent","esri/SpatialReference"],function(a,b){extent=new a(h.extent.xmin,h.extent.ymin,h.extent.xmax,h.extent.ymax,new b({wkid:h.extent.spatialReference.wkid}))});var i=Map.CreateMapExtentSpatialFilterObject(extent).Filter,j=JSON.stringify(i);if(Map.AgencyFilter.length>0&&(e=Map.AgencyFilter[0]==a),d=Map.OrganizationGraphicsLayer.visible,Map.OrganizationGraphicsLayer.visible)for(var k=0;k<Map.OrganizationGraphicsLayer.graphics.length;k++){var l=Map.OrganizationGraphicsLayer.graphics[k];if(l.attributes.id==a){Map.DisplaySelectedOrganizationGraphicsLayers(l);break}}1==b&&Map.DefaultAgencyID>-1&&(f=Map.DefaultAgencyID);try{Map.CloseFilterPanel(),Map.OrganizationDetailOpen=!0,Map.ToggleDetailRecordLoader(!0),$.ajax({url:c,type:"POST",data:{orgID:a,suggestNumCharacters:MapSettings.NumSearchCharacters,visibleAgencies:Map.VisibleAgencies,agencyFilterDisabled:d,agencyFilterChecked:e,defaultAgency:f,spatFilter:j,maxRecordCountReached:Map.HasReachedMaxRecordCount},success:function(a){if(""!=a&&null!=a){if($.slidebars.open("Error500.html"),$("#divRightPanel").html(a),"mobile"==$("#mapType").val())$("#txtOrganizationLocationSearch").show(),$("#locationSearchOrganization").hide(),$("#divMainMenu").hide(),$("#divRightPanel").show();else{$("#txtOrganizationLocationSearch").hide(),$("#locationSearchOrganization").show();var b=$("#metadataOrganizationName").html();EventTracking.MapMetadataOpenPanel(b)}Map.OrganizationID=$("#organizationID").val();var c=$("#visibleAgencies option");Map.AgenciesByExtent=[];for(var d=0;d<c.length;d++)Map.AgenciesByExtent.push({id:c[d].value,name:c[d].text});Map.CloseNavTrigger()}Map.ToggleDetailRecordLoader(!1)},error:function(a,b,c){Map.ToggleDetailRecordLoader(!1),Map.LoadErrorModal("Get Organization Detail Info - "+c,5,851e4)}})}catch(m){}},Map.ClearOrganizationSelection=function(){Map.OrganizationSelectionGraphicsLayer.clear(),null!=Map.PreviouslySelectedOrganizationGraphic&&Map.PreviouslySelectedOrganizationGraphic.show(),Map.PreviouslySelectedOrganizationGraphic=null,Map.DefaultAgencyID=-1,$("#visibleAgencies option:selected").prop("selected",!1)},Map.GetOrganizationRecords=function(){if(null!=Map.OrganizationGraphicsLayer&&Map.OrganizationGraphicsLayer.graphics.length>0){if(Map.ConstructVisibleAgencies(),Map.RefreshVisibleAgencies(!0),1==Map.OrganizationDetailOpen&&1==Map.OrganizationGraphicsLayer.visible){var a=null;if(Map.DefaultAgencyID>-1)for(var b=0;b<Map.OrganizationGraphicsLayer.graphics.length;b++){var a=Map.OrganizationGraphicsLayer.graphics[b];if(a.attributes.id==Map.DefaultAgencyID)break}null!=a&&Map.DisplaySelectedOrganizationGraphicsLayers(a)}}else{var c=ScriptHelper.GetBaseUrl()+"/map/GetOrganizations",d=!1;null!=Map.UserAccess&&(d=Map.UserAccess.aa.hs),$.ajax({url:c,type:"POST",data:{accessStaging:d},success:function(a){if(null!=a.sessionend)return void Map.EndSession(a);if(Map.ProcessOrganizationResults(a),Map.ConstructVisibleAgencies(),1==Map.OrganizationDetailOpen&&1==Map.OrganizationGraphicsLayer.visible){var b=null;if(Map.DefaultAgencyID>-1)for(var c=0;c<Map.OrganizationGraphicsLayer.graphics.length;c++){var b=Map.OrganizationGraphicsLayer.graphics[c];if(b.attributes.id==Map.DefaultAgencyID)break}null!=b&&Map.DisplaySelectedOrganizationGraphicsLayers(b)}Map.CloseModalOverlay()},error:function(a,b,c){Map.LoadErrorModal("Display Organizations - "+c,5,851e4)}})}},Map.LoadOrganizationRecords=function(){var a=ScriptHelper.GetBaseUrl()+"/map/GetOrganizations",b=!1;null!=Map.UserAccess&&(b=Map.UserAccess.aa.hs),$.ajax({url:a,type:"POST",data:{accessStaging:b},success:function(a){return null!=a.sessionend?void Map.EndSession(a):(Map.ProcessOrganizationResults(a),Map.LoadShareVisibleAgencies(),void Map.InitiateSearchRequest())},error:function(a,b,c){Map.LoadErrorModal("Display Organizations - "+c,5,851e4)}})},Map.ProcessOrganizationResults=function(a){var b=[];require(["esri/geometry/Point","esri/graphic","esri/SpatialReference"],function(b,c,d){for(var e=$.parseJSON(a),f=0;f<e.length;f++){var g=new b(e[f].x,e[f].y,new d({wkid:102100}));graphic=new c(g,null,{id:e[f].id,name:e[f].nm},null),Map.OrganizationGraphicsLayer.add(graphic)}})},Map.ConstructVisibleAgencies=function(){for(var a="[",b=0,c=0;c<Map.OrganizationGraphicsLayer.graphics.length;c++){var d=Map.OrganizationGraphicsLayer.graphics[c],e=d.geometry;Map.MainMap.extent.intersects(e)&&(b>0&&(a+=","),a+='{"na":"'+d.attributes.name+'","id":'+d.attributes.id+"}",b+=1)}a+="]";var f=JSON.parse(a);f.length>1&&f.sort(function(a,b){return a.na<b.na?-1:a.na>b.na?1:0}),Map.VisibleAgencies=JSON.stringify(f)},Map.LoadShareVisibleAgencies=function(){for(var a="[",b=0,c=!0,d=0;d<Map.OrganizationGraphicsLayer.graphics.length;d++){var e=Map.OrganizationGraphicsLayer.graphics[d];if(e.attributes.id==Map.AgencyFilter[0]){a+='{"na":"'+e.attributes.name+'","id":'+e.attributes.id+"}",c=!1;break}}a+="]",c?Map.ClearAgencyFilter():Map.VisibleAgencies=a},Map.ZoomToOrganization=function(a,b,c){require(["esri/geometry/Point","esri/SpatialReference"],function(d,e){var f=new d(a,b,new e(102100));Map.MainMap.setScale(c),Map.MainMap.centerAt(f)}),EventTracking.MapMetadataZoomToAgency()},Map.FilterByAgency=function(a,b){a.checked?(Map.AgencyFilter=[b],EventTracking.MapMetadataShowOnlyAgencyChecked()):Map.ClearAgencyFilter(),Map.AgencyFilterToggle=!0,Map.InitiateSearchRequest()},Map.CheckAgencyFilter=function(a){if(Map.AgencyFilter.length>0){for(var b=Map.AgencyFilter[0],c=!1,d="",e=0;e<a.length;e++)if(b==a[e].id){c=!0,d=a[e].na;break}0==c?Map.ClearAgencyFilter():null!=$("#summaryWhereAgencyText")[0]&&$("#summaryWhereAgencyText").text("Agency Filter: "+d)}},Map.ClearAgencyFilter=function(){Map.AgencyFilter=[],Map.VisibleAgencies=null,null!=$("#summaryWhereAgencyText")[0]&&$("#summaryWhereAgencyText").text(""),Map.ConstructVisibleAgencies(),$("#divStatusBarAgencyFilter").length>0&&($("#divStatusBarAgencyFilter")[0].style.visibility="hidden")},Map.ClearAgencyFilterStatus=function(){var a=Map.AgencyFilter;Map.ClearAgencyFilter(),1==Map.OrganizationDetailOpen&&(Map.SelectedAgencyByExtent=a),Map.RefreshVisibleAgencies(!0),Map.AgencyFilterToggle=!0,Map.InitiateSearchRequest()},Map.RefreshVisibleAgencies=function(a){var b=-1,c=$("#visibleAgencies"),d=-1,e=!1,f=!1,g=JSON.parse(Map.VisibleAgencies);if(1==Map.HasReachedMaxRecordCount){var h=$("#visibleAgencies option:selected");h.length>0?Map.DefaultAgencyID=h[0].value:Map.SelectedAgencyByExtent.length>0?(b=Map.SelectedAgencyByExtent[0],Map.SelectedAgencyByExtent=[]):Map.AgenciesByExtent.length>0&&(Map.DefaultAgencyID=Map.AgenciesByExtent[0].id),f=!0}if(Map.AgencyFilter.length>0&&(b=Map.AgencyFilter[0]),b<0&&($("#checkboxAgencyFilter").attr("checked",!1),1==a&&Map.DefaultAgencyID>-1?b=Map.DefaultAgencyID:(b=$("#visibleAgencies option:selected").val(),null==b&&(b=Map.DefaultAgencyID>-1?Map.DefaultAgencyID:-1))),$("#visibleAgencies option").remove().end(),1==f){for(var i=0;i<Map.AgenciesByExtent.length;i++){var j=Map.AgenciesByExtent[i].id,k=Map.AgenciesByExtent[i].name;j==b?(c.append('<option selected="selected" value="'+j+'">'+k+"</option>"),e=!0,d=j):c.append('<option value="'+j+'">'+k+"</option>")}!e&&Map.AgenciesByExtent.length>0&&(d=Map.AgenciesByExtent[0].id)}else{for(var i=0;i<g.length;i++){var j=g[i].id,k=g[i].na;j==b?(c.append('<option selected="selected" value="'+j+'">'+k+"</option>"),e=!0,d=j):c.append('<option value="'+j+'">'+k+"</option>")}!e&&g.length>0&&(d=g[0].id)}return d<0?($("#checkboxAgencyFilter").attr("disabled",!0),void $("#lblCheckboxAgencyFilter").css("opacity",.5)):void(null!=$("#organizationID").val()&&$("#organizationID").val()!=d?0==Map.VisibleAgencies.length?(Map.GetOrganizationRecords(),1==Map.OrganizationDetailOpen&&setTimeout(function(){Map.OpenOrganizationDetail(d,!1)},1500)):1==Map.OrganizationDetailOpen&&Map.OpenOrganizationDetail(d,!1):1==Map.OrganizationGraphicsLayer.visible?($("#checkboxAgencyFilter").attr("disabled",!0),$("#lblCheckboxAgencyFilter").css("opacity",.5)):($("#checkboxAgencyFilter").attr("disabled",!1),$("#lblCheckboxAgencyFilter").css("opacity",1)))},Map.InitiateSearchRequest=function(a){var b=null;if(Map.WhenPanelInitialized){if(null!=Map.ResultPinGraphicsLayer&&null!=Map.ResultSelectionGraphicsLayer&&null!=Map.ResultLabelGraphicsLayer){if(1==Map.MaximumResultScaleReached())return Map.ShowStatusBar("zoomin"),Map.ResultPinGraphicsLayer.setVisibility(!1),Map.ResultSelectionGraphicsLayer.setVisibility(!1),Map.ResultLabelGraphicsLayer.setVisibility(!1),Map.OrganizationSelectionGraphicsLayer.setVisibility(!0),Map.OrganizationGraphicsLayer.setVisibility(!0),null!=Map.CurrentDetailRecordAddressGraphic&&Map.MainMap.graphics.add(Map.CurrentDetailRecordAddressGraphic),null!=Map.CurrentDetailRecordLineDistanceGraphic&&Map.MainMap.graphics.add(Map.CurrentDetailRecordLineDistanceGraphic),$("#topToolbar .recordCount").hide(),$("#topToolbarAlert .recordCount").hide(),Map.CloseFilterPanel(),Map.GetOrganizationRecords(),void(Map.OrganizationDetailOpen?Map.RefreshVisibleAgencies(!0):$.slidebars.close());if(Map.HideStatusBar(),Map.ResultPinGraphicsLayer.setVisibility(!0),Map.ResultSelectionGraphicsLayer.setVisibility(!0),Map.ResultLabelGraphicsLayer.setVisibility(!0),Map.OrganizationSelectionGraphicsLayer.setVisibility(!1),Map.OrganizationGraphicsLayer.setVisibility(!1),$("#topToolbar .recordCount").show(),$("#topToolbarAlert .recordCount").show(),MapSettings.ShareMapEnabled&&null==Map.VisibleAgencies)return void Map.LoadOrganizationRecords()}if((2==Map.CurrentSpatialFilterType||1!=Map.SpatialFilterExecuted||0!=Map.AgencyFilterToggle)&&(null==a&&(a=Map.MainMap),null!=a&&null!=a.extent&&!isNaN(a.extent.xmin))){require(["esri/geometry/Extent","esri/SpatialReference"],function(c,d){b=new c(a.extent.xmin,a.extent.ymin,a.extent.xmax,a.extent.ymax,new d({wkid:a.extent.spatialReference.wkid}))});var c=Map.GetSelectedAttributes(),d=Map.CreateMapExtentSpatialFilterObject(b);if(0==Map.CurrentSpatialFilterType){d=Map.AddressFilterObj;var e=$.parseJSON(d.Filter);null==Map.CurrentBufferGraphic&&($("#whereBufferDistances").val(e.bd),$("#locationSearchWherePanel").val(e.ad))}Map.PrintMapExtent=b;var f=Map.CreateTemporalFilterObject(),g=Map.CreateMapFilterParameters(c,d,f);g.AgencyFilter.length>0?Map.ShowStatusBar("agencyfilter"):Map.ClearAgencyFilter(),Map.SearchRequest(g)}}},Map.SearchRequest=function(a){var b=ScriptHelper.GetBaseUrl()+"/map/MapUpdated",c=JSON.stringify(a),d="",e="",f=Map.SearchRequestCounter;Map.SearchRequestStack.push(f),Map.SearchRequestCounter+=1;var g=Map.CreateMapExtentSpatialFilterObject(Map.MainMap.extent).Filter,h=$.parseJSON(g);MapSettings.ShareMapEnabled&&(d=MapSettings.ShareMapID,e="{rings : "+JSON.stringify(h.rings)+"}"),$.ajax({url:b,type:"POST",data:{filterdata:c,shareMapID:d,shareMapExtent:e,alertID:MapSettings.CrimeAlertID,spatfilter:g},success:function(a){if(null!=a.sessionend)return void Map.EndSession(a);var b=Map.SearchRequestStack.length;b>0&&f==Map.SearchRequestStack[b-1]&&(Map.ProcessSearchResults(a),$.slidebars.active("left")&&Map.GetAvailableAttributes(),Map.SearchRequestStack=[],Map.SearchRequestCounter=0),Map.CloseModalOverlay()},error:function(a,b,c){Map.LoadErrorModal("Map Search Request - "+c,5,851e4)}})},Map.EndSession=function(a){"staging"==a.origin?window.location="/home":window.location="/login/admin"},Map.UpdateAttributeAvailability=function(a){for(var b=17;$("#attName"+b).length>0;){var c=$("#attName"+b).html().replace(" NA*","");$("#attName"+b).html(c).css("opacity","1.0"),$("#imgAtt"+b).css("opacity","1.0"),b+=1}if(null==a||null==a.ua||0==a.ua.length)return void $("#lblWhatDataAvail").hide();$("#lblWhatDataAvail").show();for(var d=0;d<a.ua.length;d++){var e=a.ua[d],f=$("#attName"+e).html();$("#imgAtt"+e).css("opacity","0.2"),$("#attName"+e).html(f+" NA*").css("opacity","0.2")}},Map.ProcessSearchResults=function(a){Map.ResultPinGraphicsLayer.clear(),Map.ResultSelectionGraphicsLayer.clear(),Map.ResultLabelGraphicsLayer.clear(),Map.HasReachedMaxRecordCount=!1;var b=[];Map.SetPrintMap(),require(["esri/geometry/Point","esri/graphic","esri/SpatialReference"],function(b,c,d){var e="";try{e=$.parseJSON(a)}catch(f){return}var g,h,i,j=!1,k,l;if("crimeAlert"==e.type)$("#crimeAlertName").text(e.result.nm),$("#crimeAlertPublishedDate").text(e.publishDate),g=e.result.rs.nr,h=e.result.rs.mv,i=e.result.rs.rs,k=e.result.as,l=e.result.or,$("#topToolbarAlert .recordCount").html(g+" Records"),1==MapSettings.MapType&&$("#sb-site").css("padding","100px 0px 0px 0px"),$("#leftToolbar").hide();else if("share"==e.type)i=e.result.rs.rs,g=e.result.rs.nr,l=e.result.rs.or,k=e.result.rs.st,$("#topToolbar .recordCount").html(g+" Records");else{if("error"==e.type)return void(e.code>0?8501004==e.code&&Map.LoadErrorModal("",e.level,e.code,"We no longer have data available for the date range that was selected."):window.open("Error500.html","_self"));g=e.result.nr,h=e.result.mv,i=e.result.rs,k=e.result.st,l=e.result.or,$("#topToolbar .recordCount").html(g+" Records")}if(MapSettings.ShareMapEnabled&&MapSettings.OrganizationFilter.$type.indexOf("OrganizationFilter")>0&&0==g)return MapSettings.ShareMapEnabled=!1,Map.ClearAgencyFilter(),void Map.MapExtentChanged();Map.VisibleAgencies=JSON.stringify(l),1==Map.SearchByLocation&&(Map.CheckAgencyFilter(l),Map.SearchByLocation=!1),Map.HasOffenderData=!1;for(var m=0;m<l.length;m++)if(1==l[m].od){Map.HasOffenderData=!0;break}if(null!=Map.CurrentBufferGraphic&&Map.ResultPinGraphicsLayer.add(Map.CurrentBufferGraphic),null!=Map.CurrentAddressGraphic&&(Map.ResultPinGraphicsLayer.add(Map.CurrentAddressGraphic),1==Map.ShowInfoPopUp&&Map.MainMap.infoWindow.show(Map.CurrentAddressGraphic.geometry)),null!=Map.CurrentLocationGraphic&&Map.MainMap.graphics.add(Map.CurrentLocationGraphic),null!=Map.CurrentDetailRecordAddressGraphic&&Map.MainMap.graphics.add(Map.CurrentDetailRecordAddressGraphic),null!=Map.CurrentDetailRecordLineDistanceGraphic&&Map.MainMap.graphics.add(Map.CurrentDetailRecordLineDistanceGraphic),1==k&&(Map.ShowStatusBar("maxrecords",g),Map.HasReachedMaxRecordCount=!0,"crimeAlert"!=e.type))return Map.PreviouslySelectedPin=null,!Map.OrganizationDetailOpen&&$.slidebars.active("right")?$.slidebars.toggle("right"):Map.OrganizationDetailOpen&&Map.RefreshVisibleAgencies(!0),void(2==MapSettings.MapType&&Map.EnableMobileMainMenu());if(2==k&&"crimeAlert"==e.type)return Map.PreviouslySelectedPin=null,$.slidebars.active("right")&&$.slidebars.toggle("right"),void(2==MapSettings.MapType&&Map.EnableMobileMainMenu());if(2==k)return Map.ShowStatusBar("nodataprovided"),Map.PreviouslySelectedPin=null,$.slidebars.active("right")&&$.slidebars.toggle("right"),void(2==MapSettings.MapType&&Map.EnableMobileMainMenu());if(3==k)return Map.ShowStatusBar("nodatafound"),Map.PreviouslySelectedPin=null,$.slidebars.active("right")&&$.slidebars.toggle("right"),void(2==MapSettings.MapType&&Map.EnableMobileMainMenu());if(1==k&&"crimeAlert"==e.type?Map.ShowStatusBar("missingrecords"):Map.HideStatusBar(),2==MapSettings.MapType&&Map.ShowStatusBar("recordcountanddate",g),Map.HasCrimeRecords=!1,Map.HasOffenderRecords=!1,Map.HasOffenderData&&!Map.OffenderStatusBarDismissed){
for(var n=!1,o=Map.GetSelectedAttributes(),m=0;m<o.length;m++)if(o[m]>16){n=!0;break}n?(Map.OffenderStatusBarShown=!0,Map.OffenderStatusBarDismissed=!0):(Map.OffenderStatusBarShown=!0,Map.ShowStatusBar("sexoffenderdata"))}else Map.HasOffenderData||($("#divStatusBarSexOffenderData")[0].style.visibility="hidden");for(var m=0;m<i.length;m++){var p=new b(i[m].x,i[m].y,new d({wkid:102100})),q=!1;if(graphic=new c(p,null,{LegendID:i[m].l,IDs:i[m].i},null),i[m].i.toString().indexOf("0_")>-1?Map.HasCrimeRecords=!0:i[m].i.toString().indexOf("1_")>-1&&(Map.HasOffenderRecords=!0,q=!0),1==MapSettings.ShareMapUseSelectedPinID&&null==Map.PreviouslySelectedPin&&i[m].i.toString().indexOf(MapSettings.ShareMapSelectedPinID)>-1&&(Map.PreviouslySelectedPin=graphic,j=!1),!q||Map.OffenderStatusBarDismissed)if(j||null==Map.PreviouslySelectedPin)Map.ResultPinGraphicsLayer.add(graphic);else{if(Map.ResultPinGraphicsLayer.add(graphic),i[m].i.length>1){j=!0;for(var r=Map.PreviouslySelectedPin.attributes.IDs.toString(),s=0;s<i[m].i.length;s++){var t=i[m].i[s];if(r.indexOf(t)<0){j=!1;break}}}else i[m].i.toString().indexOf(Map.PreviouslySelectedPin.attributes.IDs.toString())>-1&&(j=!0);j&&(Map.PreviouslySelectedPin=graphic,Map.TogglePinGraphic(!1),Map.DisplaySelectedValueGraphicsLayers(Map.PreviouslySelectedPin),Map.PinLabelSelected=!0)}}if(0==Map.CurrentSpatialFilterType&&0==Map.SpatialFilterExecuted)if(null==Map.CurrentBufferGraphic){spatialfilter=Map.AddressFilterObj;var u=$.parseJSON(spatialfilter.Filter),v=null;require(["esri/geometry/webMercatorUtils"],function(a){v=a.webMercatorToGeographic(Map.CenterPoint)}),Map.CreateAddressGraphic(v,u.ad,"initsearch"),Map.CreateBufferGraphic(v)}else Map.SpatialFilterExecuted=!0;j||null==Map.PreviouslySelectedPin||Map.AgencyFilterToggle||(Map.PreviouslySelectedPin=null,!Map.OrganizationDetailOpen&&$.slidebars.active("right")&&$.slidebars.toggle("right"),2==MapSettings.MapType&&Map.EnableMobileMainMenu());var w=!1,x=!1;x=w=Map.HasCrimeRecords,Map.HasOffenderRecords&&(w=!Map.OffenderDisclaimerShown||!!Map.OffenderDisclaimerAccepted),w?($("#displayReports").removeClass("viewReportToolbarDisabled"),$("#displayReports").attr("onclick","Map.OpenReport()")):0==$("#displayReports").hasClass("viewReportToolbarDisabled")&&($("#displayReports").addClass("viewReportToolbarDisabled"),$("#displayReports").attr("onclick","javascript:void(0)")),x?($("#reportCharts").removeClass("viewChartsToolbarDisabled"),$("#reportCharts").attr("onclick","Map.OpenReport(true)")):0==$("#reportCharts").hasClass("viewChartsToolbarDisabled")&&($("#reportCharts").addClass("viewChartsToolbarDisabled"),$("#reportCharts").attr("onclick","javascript:void(0)"))}),1==MapSettings.ShareMapUseSelectedPinID&&null!=Map.PreviouslySelectedPin&&(Map.GetDetailRecordInformation(Map.PreviouslySelectedPin,MapSettings.ShareMapSelectedPinID),MapSettings.ShareMapUseSelectedPinID=!1),Map.UpdateSummaryWhere(),Map.UpdateSummaryWhen(),Map.AgencyFilterToggle?(Map.RefreshVisibleAgencies(!1),Map.AgencyFilterToggle=!1):Map.OrganizationDetailOpen&&(0==Map.VisibleAgencies.length&&Map.GetOrganizationRecords(),Map.RefreshVisibleAgencies(!1)),MapSettings.ShareMapEnabled=!1},Map.PrepareBasemapLayer=function(a){var b=null,c=a.$type.split(",")[0];return c.toLowerCase().indexOf("tilebackgroundlayer")>-1&&require(["esri/layers/ArcGISTiledMapServiceLayer"],function(c){b=new c(a.ul,{id:a.nm}),b.minScale=MapSettings.MinScale,b.maxScale=MapSettings.MaxScale}),b},Map.MaximumResultScaleReached=function(){var a=Map.MainMap.getScale(),b=Map.MainMap.getZoom();return a>MapSettings.MaxResultScale},Map.BasemapSelected=function(a){var b=null;b=null!=a.item?this.dataItem(a.item):a;var c=MapSettings.GetBasemapById(b.ID),d=Map.PrepareBasemapLayer(c);Map.MainMap.removeLayer(Map.BasemapLayer),Map.BasemapLayer=d,Map.OmegaBasemapLayer=c,Map.MainMap.addLayer(d,0),Map.SetPrintMap(),EventTracking.MapInteractionsBasemapSelected(c.nm)},Map.MobileBasemapSelected=function(a){var b=MapSettings.GetBasemapById(a),c=Map.PrepareBasemapLayer(b);Map.MainMap.removeLayer(Map.BasemapLayer),Map.BasemapLayer=c,Map.OmegaBasemapLayer=b,Map.MainMap.addLayer(c,0)},Map.BasemapChanged=function(a){},Map.ZoomIn=function(){var a=Map.MainMap.getLevel();a+=1,Map.MainMap.setLevel(a),EventTracking.MapInteractionsZoomIn()},Map.ZoomOut=function(){var a=Map.MainMap.getLevel();a-=1,Map.MainMap.setLevel(a),EventTracking.MapInteractionsZoomOut()},Map.MyLocation=function(){null==Map.CurrentLocationGraphic?(navigator.geolocation&&navigator.geolocation.getCurrentPosition(MyLocationPosition,MyLocationPositionError),EventTracking.MapInteractionsMyLocation()):(Map.MainMap.graphics.remove(Map.CurrentLocationGraphic),Map.CurrentLocationGraphic=null)},Map.MeasureDistance=function(){null==Map.ToolBar&&($.slidebars.close(),Map.CloseFilterPanel(),Map.ClearMeasureDistanceGraphic(),require(["esri/toolbars/draw","esri/Color","esri/symbols/SimpleLineSymbol"],function(a,b,c){var d=new a(Map.MainMap,{showTooltips:!0,tooltipOffset:40}),e=new b([5,140,245]),f=new c(c.STYLE_SOLID,e,3);Map.ToolBar=d,Map.ToolBar.setLineSymbol(f),Map.MeasureDistanceEnabled=!0,Map.ToolBar.activate(a.POLYLINE),$(".distanceTool").addClass("distanceToolActive"),null!=$("#measurementInfo")[0]&&($("#measurementInfo")[0].style.visibility="visible"),Map.MainMap.setMapCursor("url("+Map.ResourcePath+"/images/map/cyan_crosshair.cur),auto")})),EventTracking.MapInteractionsOpenDistanceTool()},Map.MeasureUnitChange=function(a){Map.UpdateMeasureDistance()},Map.MeasurePreview=function(a){require(["esri/geometry/Polyline","esri/geometry/webMercatorUtils","esri/units","esri/geometry/geodesicUtils"],function(b,c,d,e){if(null!=Map.MeasureDistanceLine){var f="",g,h="",i=Map.MeasureDistanceLine.paths[0].length-1;switch(f=null!=$("#ddlMapUnits")[0]?$("#ddlMapUnits")[0].value:"Mile"){case"Mile":g=d.MILES,h=" Miles";break;case"Feet":g=d.FEET,h=" Feet";break;case"Kilometer":g=d.KILOMETERS,h=" Kilometers";break;case"Meter":g=d.METERS,h=" Meters"}var j=new b,k=Map.MeasureDistanceLine.paths[0][i][0],l=Map.MeasureDistanceLine.paths[0][i][1],m=a.x,n=a.y;j.spatialReference=Map.MeasureDistanceLine.spatialReference,j.addPath([[k,l],[m,n]]);var o=c.webMercatorToGeographic(j),p=c.webMercatorToGeographic(Map.MeasureDistanceLine),q=e.geodesicLengths([o],g),r=e.geodesicLengths([p],g);null!=$("#measurementValue")[0]&&($("#measurementValue")[0].innerHTML=(q[0]+r[0]).toFixed(2)+h)}})},Map.UpdateMeasureDistance=function(a){require(["esri/geometry/Polyline","esri/geometry/webMercatorUtils","esri/units","esri/geometry/geodesicUtils"],function(b,c,d,e){if(null==Map.MeasureDistanceLine){if(null==a)return;Map.MeasureDistanceLine=new b(a.spatialReference),Map.MeasureDistanceLine.addPath([a])}else{var f="",g,h="";switch(f=null==$("#ddlMapUnits")[0]?"Mile":$("#ddlMapUnits")[0].value){case"Mile":g=d.MILES,h=" Miles";break;case"Feet":g=d.FEET,h=" Feet";break;case"Kilometer":g=d.KILOMETERS,h=" Kilometers";break;case"Meter":g=d.METERS,h=" Meters"}null!=a&&Map.MeasureDistanceLine.insertPoint(0,Map.MeasureDistanceLine.paths[0].length,a);var i=c.webMercatorToGeographic(Map.MeasureDistanceLine),j=e.geodesicLengths([i],g);if(null==$("#measurementValue")[0])return;$("#measurementValue")[0].innerHTML=j[0].toFixed(2)+h}})},Map.IsRightPanelPinned=!1,Map.IgnoreExtentChanged=!1,Map.ToggleRightPanelPinMode=function(){Map.IsRightPanelPinned?(Map.IsRightPanelPinned=!1,Map.UnpinRightPanel()):(Map.IsRightPanelPinned=!0,Map.IgnoreExtentChanged=!0,Map.PinRightPanel())},Map.PinRightPanel=function(){var a=$("#rightPanel").width()+75,b=window.innerWidth,c=b-a+"px";b-a!=Map.MainMap.width&&(Map.IgnoreExtentChanged=!0,$("#map").width(c),$("#rightPanelPin").addClass("PinPanelSelected"))},Map.UnpinRightPanel=function(){$("#map").width("100%"),$("#rightPanelPin").removeClass("PinPanelSelected")},Map.CloseRightPanel=function(){Map.IsRightPanelPinned&&Map.ToggleRightPanelPinMode(),Map.TogglePinGraphic(!0),Map.OrganizationDetailOpen=!1,2==MapSettings.MapType&&Map.EnableMobileMainMenu()},Map.LoadPanels=function(a){var b="";b=ScriptHelper.GetBaseUrl()+"/map/loadpanels",$("#leftPanelLoader").show();var c=JSON.stringify(a.WhatAttributeCategories),d=JSON.stringify(a.TemporalFilterSettings),e=JSON.stringify(a.SpatialFilterSettings.bs),f=JSON.stringify(a.SuggestionSettings),g=MapSettings.MapType,h=MapSettings.DefaultBuffer;$.ajax({url:b,type:"POST",data:{attCat:c,tempFilt:d,bufferSC:e,suggSettings:f,mapType:g,dfltBuffer:h},success:function(a){return null!=a.sessionend?void Map.EndSession(a):($("#divLeftPanel").html(""),$("#divLeftPanel").html(a),$("#summaryPanel").hide(),$("#whatPanel").hide(),$("#wherePanel").hide(),$("#whenPanel").hide(),void $("#leftPanelLoader").hide())},error:function(a,b,c){Map.LoadErrorModal("Load Left Panels - "+c,5,851e4),$("#leftPanelLoader").hide()}})},Map.RestoreDefaultSettings=function(){var a=$("#whatListView").find(":input");for(d=0;d<a.length;d++){var b=parseInt(a[d].id.replace("chkAtt",""));b<=16?a[d].checked=!0:a[d].checked=!1}Map.CurrentSpatialFilterType=2,Map.SpatialFilterExecuted=!1,Map.ClearAgencyFilter(),Map.RemoveAddressGraphic(),null!=Map.CurrentBufferGraphic&&(Map.ResultPinGraphicsLayer.remove(Map.CurrentBufferGraphic),Map.CurrentBufferGraphic=null),Map.MainMap.infoWindow.hide();for(var c=!1,d=0;d<MapSettings.Shortcuts.length;d++)if("Previous Week"==MapSettings.Shortcuts[d].na){c=MapSettings.Shortcuts[d].cd;break}Map.CheckDateRange("Previous Week",7,3,c),EventTracking.MapSummaryRestoreDefaults()},Map.GetAvailableAttributes=function(){var a="";a=ScriptHelper.GetBaseUrl()+"/map/GetUnavailableAttributes";var b=$.parseJSON(Map.CreateMapExtentSpatialFilterObject(Map.MainMap.extent).Filter),c=JSON.stringify(b);$.ajax({url:a,type:"POST",data:{filterdata:c},success:function(a){if(null!=a.sessionend)return void Map.EndSession(a);if(null!=a&&""!=a){var b="";try{b=$.parseJSON(a)}catch(c){return}Map.UpdateAttributeAvailability(b.attavail),Map.UpdateSummaryWhat(b.attavail)}else Map.UpdateAttributeAvailability(),Map.UpdateSummaryWhat()},error:function(a,b,c){}})},Map.LoadFiltersPanel=function(a){"what"==a?($("#whatPanel").is(":visible")?(Map.CloseFilterPanel(),$.slidebars.close()):($(".sb-left").hasClass("sb-active")||$.slidebars.open("Error500.html"),$("#whatPanel").show(),$("#filtersWhat").removeClass("filterHover"),$("#filtersWhat").addClass("filterSelected"),$("#whenPanel").hide(),$("#wherePanel").hide(),$("#summaryPanel").hide(),$("#filtersSummary").removeClass("filterSelected"),$("#filtersWhere").removeClass("filterSelected"),$("#filtersWhen").removeClass("filterSelected"),Map.GetAvailableAttributes()),EventTracking.MapWhatOpenPanel()):"when"==a?($("#whenPanel").is(":visible")?(Map.CloseFilterPanel(),$.slidebars.close()):($(".sb-left").hasClass("sb-active")||$.slidebars.open("Error500.html"),$("#whenPanel").show(),$("#filtersWhen").removeClass("filterHover"),$("#filtersWhen").addClass("filterSelected"),$("#whatPanel").hide(),$("#wherePanel").hide(),$("#summaryPanel").hide(),$("#filtersWhat").removeClass("filterSelected"),$("#filtersWhere").removeClass("filterSelected"),$("#filtersSummary").removeClass("filterSelected")),EventTracking.MapWhenOpenPanel()):"where"==a?($("#wherePanel").is(":visible")?(Map.CloseFilterPanel(),$.slidebars.close()):($(".sb-left").hasClass("sb-active")||$.slidebars.open("Error500.html"),$("#wherePanel").show(),$("#filtersWhere").removeClass("filterHover"),$("#filtersWhere").addClass("filterSelected"),$("#whatPanel").hide(),$("#whenPanel").hide(),$("#summaryPanel").hide(),$("#filtersWhat").removeClass("filterSelected"),$("#filtersSummary").removeClass("filterSelected"),$("#filtersWhen").removeClass("filterSelected")),EventTracking.MapWhereOpenPanel()):"summary"==a&&($("#summaryPanel").is(":visible")?(Map.CloseFilterPanel(),$.slidebars.close()):($(".sb-left").hasClass("sb-active")||$.slidebars.open("Error500.html"),$("#summaryPanel").show(),$("#filtersSummary").removeClass("filterHover"),$("#filtersSummary").addClass("filterSelected"),$("#whatPanel").hide(),$("#whenPanel").hide(),$("#wherePanel").hide(),$("#filtersWhat").removeClass("filterSelected"),$("#filtersWhere").removeClass("filterSelected"),$("#filtersWhen").removeClass("filterSelected"),Map.GetAvailableAttributes()),EventTracking.MapSummaryOpenPanel()),SetPanelVerticalPosition()},Map.CloseFilterPanel=function(){$("#filtersWhat").removeClass("filterSelected"),$("#filtersWhere").removeClass("filterSelected"),$("#filtersWhen").removeClass("filterSelected"),$("#filtersSummary").removeClass("filterSelected")},Map.filterMouseOver=function(a){var b="#"+a.id;$(b).hasClass("filterSelected")||$(b).addClass("filterHover")},Map.filterMouseOut=function(a){var b="#"+a.id;$(b).removeClass("filterHover")},Map.WhatAttributeCategoriesSelectAll=function(){var a=$("#whatListView").find(":input");for(i=0;i<a.length;i++)$(a[i]).is(":visible")&&(a[i].checked=!0);Map.WhatPanelSave()},Map.WhatAttributeCategoriesDeselectAll=function(){var a=$("#whatListView").find(":input");for(i=0;i<a.length;i++)$(a[i]).is(":visible")&&(a[i].checked=!1);Map.WhatPanelSave()},Map.GetSelectedAttributes=function(){var a=$("#whatListView").find(":input"),b=[];for(i=0;i<a.length;i++)a[i].checked&&b.push(a[i].name);return b},Map.WhatPanelClick=function(a){var b=$("#chkAtt"+a)[0];1==b.checked?b.checked=!1:b.checked=!0,Map.WhatPanelSave()},Map.WhatPanelSave=function(){for(var a="",b=Map.GetSelectedAttributes(),c=0;c<b;c++)a+=b[c],c!=b.length-1&&(a+=", ");EventTracking.MapWhatIncidentTypesChanged(a),Map.SpatialFilterExecuted=!1,Map.InitiateSearchRequest()},$(window).scroll(SetPanelVerticalPosition),Map.WhenPanelInit=function(){if(null!=Map.MainMap&&null!=Map.MainMap.extent){var a=new Date,b=MapSettings.MaxSearchDate,c=b.substring(0,4)+"/"+b.substring(4,6)+"/"+b.substring(6,8);$("#dateFrom").kendoDatePicker({animation:!1,min:new Date(c),change:function(){Map.DateFromPreview(this.value())}}),$("#dateTo").kendoDatePicker({animation:!1,min:new Date(c),change:function(){Map.DateToPreview(this.value())}});var d="",e=0,f="",g=!1;if(1==MapSettings.ShareMapEnabled)if(1==MapSettings.DefaultFilter.ft){e=MapSettings.DefaultFilter.nd;for(var h=0;h<MapSettings.Shortcuts.length;h++)if(MapSettings.Shortcuts[h].nd==e){g=MapSettings.Shortcuts[h].cd,d=MapSettings.Shortcuts[h].na,f=MapSettings.Shortcuts[h].id;break}}else Map.ExplicitStartDate=MapSettings.DefaultFilter.sd,Map.ExplicitEndDate=MapSettings.DefaultFilter.ed,d="Custom Time Range";else{d=MapSettings.DefaultFilter.na,f=MapSettings.DefaultFilter.id,e=MapSettings.DefaultFilter.nd;for(var h=0;h<MapSettings.Shortcuts.length;h++)if(MapSettings.Shortcuts[h].na==d){g=MapSettings.Shortcuts[h].cd;break}}Map.CheckDateRange(d,e,f,g),null!=Map.ResultPinGraphicsLayer&&null!=Map.ResultSelectionGraphicsLayer&&null!=Map.ResultLabelGraphicsLayer||Map.LoadGraphics(),Map.WhenPanelInitialized=!0,Map.MainMap.setExtent(Map.MainMap.extent)}else setTimeout(Map.WhenPanelInit,200)},Map.DateFromPreview=function(a){var b=null,c=null;$("#dateFromDesc")[0].innerHTML=Map.ParseDay(a.getDay())+", "+Map.ParseMonth(a.getMonth())+" "+a.getDate()+", "+a.getFullYear(),b=new Date(Map.ParseMonth(a.getMonth())+" "+a.getDate()+", "+a.getFullYear());var d=$("#dateTo").data("kendoDatePicker");d.min(b),c=d.value(),null!=c&&b>c&&d.value(b),Map.SetDateRange("Custom Time Range")},Map.DateToPreview=function(a){$("#dateToDesc")[0].innerHTML=Map.ParseDay(a.getDay())+", "+Map.ParseMonth(a.getMonth())+" "+a.getDate()+", "+a.getFullYear(),Map.SetDateRange("Custom Time Range")},Map.ParseDay=function(a){var b="";switch(a){case 1:b="Monday";break;case 2:b="Tuesday";break;case 3:b="Wednesday";break;case 4:b="Thursday";break;case 5:b="Friday";break;case 6:b="Saturday";break;case 0:b="Sunday"}return b},Map.ParseMonth=function(a){var b="";switch(a){case 0:b="January";break;case 1:b="February";break;case 2:b="March";break;case 3:b="April";break;case 4:b="May";break;case 5:b="June";break;case 6:b="July";break;case 7:b="August";break;case 8:b="September";break;case 9:b="October";break;case 10:b="November";break;case 11:b="December"}return b},Map.ParseMonthByAbbrev=function(a){var b="";switch(a){case"Jan":b="January";break;case"Feb":b="February";break;case"Mar":b="March";break;case"Apr":b="April";break;case"May":b="May";break;case"Jun":b="June";break;case"Jul":b="July";break;case"Aug":b="August";break;case"Sep":b="September";break;case"Oct":b="October";break;case"Nov":b="November";break;case"Dec":b="December"}return b},Map.CheckDateRange=function(a,b,c,d){var e=a.split(" ").join("");$(".whenCheckBox").each(function(){$(this)[0].style.visibility="hidden"}),null!=$("#customDate")[0]&&($("#customDate")[0].style.visibility="hidden"),"Custom Time Range"!=a?(null!=$("#imgChk"+e)[0]&&($("#imgChk"+e)[0].style.visibility=""),Map.SelectedFilterType="Previous",Map.SelectedPreviousShortcutId=c,Map.PreviousNumDays=b,Map.PreviousName=a,Map.UseCurrentDay="true"==d,Map.SpatialFilterExecuted=!1):(Map.SelectedFilterType="Explicit",null!=$("#imgChkCustomTimeRange")[0]&&($("#imgChkCustomTimeRange")[0].style.visibility=""),null!=$("#customDate")[0]&&($("#customDate")[0].style.visibility="")),Map.SetDateRange(a,b),EventTracking.MapWhenShortcuts()},Map.SetDateRange=function(a,b){var c=new Date,d=new Date,e=$("#dateFrom").data("kendoDatePicker"),f=$("#dateTo").data("kendoDatePicker"),g="",h="",i="",j="",k=new Date;k.setDate(k.getDate()-180);var l=function(){var a=new Date,b=$("#dateFrom").data("kendoDatePicker"),c=$("#dateTo").data("kendoDatePicker"),d=new Date($("#dateTo").val());d<k&&(d=a,c.value(d));var e=new Date($("#dateFrom").val());e>d&&(e.setDate(d),b.value(e)),Map.SetDateLabels()},m=function(){var a=$("#dateFrom").data("kendoDatePicker"),b=$("#dateTo").data("kendoDatePicker"),c=new Date($("#dateFrom").val());c<k&&(c=k,a.value(k));var d=new Date($("#dateTo").val());d<c&&b.value(c),Map.SetDateLabels()};if($("#dateFrom").kendoDatePicker({change:m,open:function(a){this.min(k)}}),$("#dateTo").kendoDatePicker({change:l,open:function(a){var b=new Date($("#dateFrom").val());b.setDate(b.getDate()),this.min(b)}}),"Custom Time Range"!=a){var n="";c.setDate(c.getDate()-b),d.setDate(d.getDate()-1),g=""+(c.getMonth()+1),1==g.length&&(g="0"+g),h=""+c.getDate(),1==h.length&&(h="0"+h),i=""+(d.getMonth()+1),1==i.length&&(i="0"+i),j=""+d.getDate(),1==j.length&&(j="0"+j),Map.ExplicitStartDate=c.getFullYear()+""+g+h,Map.ExplicitEndDate=d.getFullYear()+""+i+j,null!=e&&null!=f&&(e.value(c),f.value(d),Map.DateFromPreview(c),Map.DateToPreview(d)),n=Map.GetDateRangeVal(c,d),null!=$("#dateRangeVal")[0]&&($("#dateRangeVal")[0].innerHTML=n),Map.WhenPanelInitialized&&Map.InitiateSearchRequest()}else Map.SetDateLabels(),c=new Date($("#dateFrom").val()),d=new Date($("#dateTo").val()),g=""+(c.getMonth()+1),1==g.length&&(g="0"+g),h=""+c.getDate(),1==h.length&&(h="0"+h),i=""+(d.getMonth()+1),1==i.length&&(i="0"+i),j=""+d.getDate(),1==j.length&&(j="0"+j),Map.ExplicitStartDate=c.getFullYear()+""+g+h,Map.ExplicitEndDate=d.getFullYear()+""+i+j;null!=f&&(f.min(c),f.value(d))},Map.SetDateLabels=function(){var a=new Date,b=new Date,c=$("#dateFrom").data("kendoDatePicker"),d=$("#dateTo").data("kendoDatePicker"),e="",f="",g="",h="",i=null,j=null;if(null!=c&&null!=d&&(1==MapSettings.ShareMapEnabled&&(c.value(new Date(Map.ExplicitStartDate.substring(4,6)+"/"+Map.ExplicitStartDate.substring(6,8)+"/"+Map.ExplicitStartDate.substring(0,4))),d.value(new Date(Map.ExplicitEndDate.substring(4,6)+"/"+Map.ExplicitEndDate.substring(6,8)+"/"+Map.ExplicitEndDate.substring(0,4))),null!=$("#dateRangeVal")[0]&&($("#dateRangeVal")[0].innerHTML=Map.GetDateRangeVal(c.value(),d.value()))),i=c.value(),j=d.value(),null!=i&&null!=j)){var k=String(i).split(" "),l=String(j).split(" "),m="",n="";m=k[3].indexOf(":")>-1?k[5]:k[3],n=l[3].indexOf(":")>-1?l[5]:l[3],a=new Date(Map.ParseMonthByAbbrev(k[1])+" "+k[2]+", "+m),b=new Date(Map.ParseMonthByAbbrev(l[1])+" "+l[2]+", "+n),$("#dateFromDesc")[0].innerHTML=Map.ParseDay(a.getDay())+", "+Map.ParseMonth(a.getMonth())+" "+a.getDate()+", "+a.getFullYear(),$("#dateToDesc")[0].innerHTML=Map.ParseDay(b.getDay())+", "+Map.ParseMonth(b.getMonth())+" "+b.getDate()+", "+b.getFullYear()}},Map.ApplyExplicitDate=function(){var a=$("#dateFrom").data("kendoDatePicker"),b=$("#dateTo").data("kendoDatePicker"),c=a.value(),d=b.value();if(null!=c&&null!=d){var e=String(c).split(" "),f=String(d).split(" "),g="",h="",i="",j="",k="",l="";k=e[3].indexOf(":")>-1?e[5]:e[3],l=f[3].indexOf(":")>-1?f[5]:f[3],dateFrom=new Date(Map.ParseMonthByAbbrev(e[1])+" "+e[2]+", "+k),dateTo=new Date(Map.ParseMonthByAbbrev(f[1])+" "+f[2]+", "+l),g=""+(dateFrom.getMonth()+1),1==g.length&&(g="0"+g),h=""+dateFrom.getDate(),1==h.length&&(h="0"+h),i=""+(dateTo.getMonth()+1),1==i.length&&(i="0"+i),j=""+dateTo.getDate(),1==j.length&&(j="0"+j),Map.ExplicitStartDate=dateFrom.getFullYear()+""+g+h,Map.ExplicitEndDate=dateTo.getFullYear()+""+i+j,null!=$("#dateRangeVal")[0]&&($("#dateRangeVal")[0].innerHTML=Map.GetDateRangeVal(dateFrom,dateTo)),Map.SpatialFilterExecuted=!1,Map.InitiateSearchRequest(),EventTracking.MapWhenCustomCalendar()}},Map.GetDateRangeVal=function(a,b){var c=Math.round((b-a)/864e5),d=a.getMonth()+1+"-"+a.getDate()+"-"+a.getFullYear(),e=b.getMonth()+1+"-"+b.getDate()+"-"+b.getFullYear(),f="",g="",h=new Date,i=!1;return i=h.getDate()==a.getDate()&&h.getDate()==b.getDate(),c+=1,1==(!i&&Map.UseCurrentDay)&&(c+=1),"Previous"==Map.SelectedFilterType&&(Map.PreviousNumDays=c),g=1==c?"(1 Day)":"("+c+" Days)",f=d+" to "+e+" "+g},Map.CurrentSpatialFilterType=2,Map.AddressFilterObj=null,Map.GeographyFilterObj=null,Map.SpatialFilterExecuted=!1,Map.ApplySpatialFilter=function(){Map.CurrentSpatialFilterType=0,Map.SpatialFilterExecuted=!1,Map.GeocodeSearchAddressWherePanel(),EventTracking.MapWhereSearchApplied()},Map.ClearSpatialFilter=function(){Map.CurrentSpatialFilterType=2,Map.SpatialFilterExecuted=!1,Map.RemoveAddressGraphic(),null!=Map.CurrentBufferGraphic&&(Map.ResultPinGraphicsLayer.remove(Map.CurrentBufferGraphic),Map.CurrentBufferGraphic=null),Map.MainMap.infoWindow.hide(),Map.InitiateSearchRequest()},Map.CreateMapExtentObject=function(a,b,c,d,e){var f=$("");return f.WKID=e,f.XMin=a,f.XMax=b,f.YMin=c,f.YMax=d,f},Map.CreateAddressSpatialFilterObject=function(a,b,c,d){var e=$("");e.FilterType=0;var f=$("");return f.x=b,f.y=c,f.ad=a,f.bd=d,e.Filter=JSON.stringify(f),Map.PrintMapBufferDistance=d,Map.PrintMapBufferAddress=a,e},Map.CreateGeographicFilterObject=function(){var a=$("");a.FilterType=1},Map.CreateMapExtentSpatialFilterObject=function(a){var b=$("");return b.FilterType=2,require(["esri/geometry/Polygon"],function(c){var d=null,e=null;d=c.fromExtent(a),e=d.toJson();var f=$("");b.Filter=JSON.stringify(e)}),b},Map.CreateTemporalFilterObject=function(){var a=$("");return a.PreviousID=Map.SelectedPreviousShortcutId,a.PreviousNumDays=Map.PreviousNumDays,a.PreviousName=Map.PreviousName,a.FilterType=Map.SelectedFilterType,a.ExplicitStartDate=Map.ExplicitStartDate,a.ExplicitEndDate=Map.ExplicitEndDate,a},Map.CreateMapFilterParameters=function(a,b,c){var d=$("");return d.SelectedCategories=a,d.SpatialFilter=b,d.TemporalFilter=c,d.AgencyFilter=Map.AgencyFilter,d},Map.CloseModalOverlay=function(){Map.OffenderDisclaimerVisible||($("#modalBgTransparency").hide(),$("#modalDialog").html(""),$("#modalDialog").hide())},Map.OpenModalOverlay=function(){$("#modalBgTransparency").show(),$("#modalDialog").show()},Map.LoadErrorModal=function(a,b,c,d){var e=ScriptHelper.GetBaseUrl()+"/map/LoadErrorModal";$.ajax({url:e,type:"GET",data:{message:a,errorLevel:b,errorCode:c},success:function(a){return null!=a.sessionend?void Map.EndSession(a):($("#modalDialog").html(a),null!=d&&$("#modalMapErrorMessage").html(d),null!=$("#mapErrorClose")[0]&&8501004==c&&$("#mapErrorClose").attr("onclick","Map.CheckDateRange('Previous Week', 7, 3, 'false')"),void Map.OpenModalOverlay())},error:function(a,b,c){alert(c)}})},Map.LoadActivityModal=function(){var a=ScriptHelper.GetBaseUrl()+"/map/LoadActivityModal";$.ajax({url:a,type:"GET",success:function(a){return null!=a.sessionend?void Map.EndSession(a):void $("#modalDialog").html(a)},error:function(a,b,c){Map.LoadErrorModal("Load Activity Modal - "+c,5,851e4)}})},Map.LoadOffenderDisclaimerModal=function(a){var b=ScriptHelper.GetBaseUrl()+"/map/LoadOffenderDisclaimerModal";Map.OpenModalOverlay(),$.ajax({url:b,type:"GET",data:{source:a},success:function(a){return null!=a.sessionend?void Map.EndSession(a):($("#modalDialog").html(a),Map.OffenderDisclaimerVisible=!0,Map.CloseModalOverlay(),void $("#modalDialog").show())},error:function(a,b,c){Map.LoadErrorModal("Load Activity Modal - "+c,5,851e4)}})},Map.AcceptOffenderDisclaimerModal=function(a){if(Map.OffenderDisclaimerAccepted=!0,Map.OffenderDisclaimerVisible=!1,Map.OffenderDisclaimerShown=!0,Map.SetPrintMap(),Map.CloseModalOverlay(),"detailrecord"==a){var b=Map.PreviouslySelectedPin;Map.GetDetailRecordInformation(b)}else"report"==a?Map.OpenReport():"chart"==a&&Map.OpenReport(!0)},Map.DeclineOffenderDisclaimerModal=function(a){Map.OffenderDisclaimerAccepted=!1,Map.OffenderDisclaimerVisible=!1,Map.OffenderDisclaimerShown=!0,Map.CloseModalOverlay(),"report"==a?Map.OpenReport():"chart"==a?Map.OpenReport(!0):Map.OffenderDisclaimerShown=!1},Map.ToggleOffenderData=function(a){var b=$("#whatListView").find(":input");for(i=0;i<b.length;i++){var c=parseInt(b[i].id.replace("chkAtt",""));c>=17&&$(b[i]).prop("checked",a)}null!=Map.PreviouslySelectedPin&&Map.GetDetailRecordInformation(Map.PreviouslySelectedPin)},Map.CloseOffenderStatusBar=function(a){$("#divStatusBarSexOffenderData")[0].style.visibility="hidden",Map.OffenderStatusBarDismissed=!0,Map.ToggleOffenderData(a),2==MapSettings.MapType&&(Map.SetStatusBarPosition(status,$("#divClientLogIn")[0]),Map.SetStatusBarPosition(status,$("#divStatusBarRecordCountAndDate")[0])),Map.WhatPanelSave()},Map.OpenReport=function(a){var b="/map/LoadReport",c="",d=Map.MainMap.extent.getCenter().x,e=Map.MainMap.extent.getCenter().y,f=Map.MainMap.getScale(),g=!0,h=!1;if(Map.UnMappedOrgIDs=[],(navigator.userAgent.indexOf("iPhone",0)>-1||navigator.userAgent.indexOf("Android",0)>-1)&&(h=!0),Map.HasOffenderRecords){if(!Map.OffenderDisclaimerAccepted&&!Map.OffenderDisclaimerShown){var i="";return i=a?"chart":"report",void Map.LoadOffenderDisclaimerModal(i)}if(Map.OffenderDisclaimerShown=!1,!Map.OffenderDisclaimerAccepted&&!Map.HasCrimeRecords)return;!Map.OffenderDisclaimerAccepted&&Map.HasCrimeRecords&&(g=!1)}$("#sb-site")[0].style.display="none",Map.MainMap.visible=!1,$("#divReportPage")[0].style.display="",$("#mapnavigation").hide(),$("#lblnavtrigger").hide(),$("#nav-trigger").hide(),$.slidebars.close(),Map.CloseFilterPanel();var j=Map.MainMap;require(["esri/geometry/Extent","esri/SpatialReference"],function(a,b){extent=new a(j.extent.xmin,j.extent.ymin,j.extent.xmax,j.extent.ymax,new b({wkid:j.extent.spatialReference.wkid}))});var k=Map.GetSelectedAttributes(),l=Map.CreateMapExtentSpatialFilterObject(extent);0==Map.CurrentSpatialFilterType&&(l=Map.AddressFilterObj);var m=Map.CreateTemporalFilterObject(),n=Map.CreateMapFilterParameters(k,l,m),o=JSON.stringify(n);a?(Map.LoadSpinner("Preparing Charts"),Map.OpenModalOverlay()):(Map.LoadSpinner("Preparing Report"),Map.OpenModalOverlay()),$.ajax({url:b,type:"POST",data:{filter:o,coordx:d,coordy:e,scale:f,showOffRecs:g,mapType:MapSettings.MapType,phneDevice:h},success:function(b){if(null!=b){if(null!=b.sessionend)return void Map.EndSession(b);if(null!=b.response&&null!=b.response.sessionend)return void Map.EndSession(b.response);$("#divReportPage").html(b),Map.CloseNavTrigger(),a?(Map.ChartReportToggle(!0),EventTracking.MapOpenReport()):(Map.ChartReportToggle(!1),EventTracking.MapOpenChart())}Map.ReportsPageOpen=!0,Map.HasCrimeRecords||$("#chartsTab").hide(),Map.CloseModalOverlay()},error:function(a,b,c){Map.CloseModalOverlay(),Map.LoadErrorModal("Report - "+c,5,851e4)}})},Map.ReportGridRequest=function(a){if(null!=a.response.sessionend)return Map.PreviouslySelectedPin=null,Map.ReportBackToMap(),void Map.EndSession(a.response)},Map.UnmappedOffenderToggle=function(a,b){var c="/map/UnmappedOffenderToggle",d="",e=Map.MainMap.extent.getCenter().x,f=Map.MainMap.extent.getCenter().y,g=Map.MainMap.getScale(),h=!1;$("#chkUnMappableOffenders"+a).length&&($("#chkUnMappableOffenders"+a).is(":checked")?$("#chkUnMappableOffenders"+a).attr("checked",!1):$("#chkUnMappableOffenders"+a).attr("checked",!0)),h=$("#chkUnMappableOffenders"+a).is(":checked"),h?$.inArray(a,Map.UnMappedOrgIDs)<0&&Map.UnMappedOrgIDs.push(a):$.inArray(a,Map.UnMappedOrgIDs)>=0&&Map.UnMappedOrgIDs.splice(Map.UnMappedOrgIDs.indexOf(a),1);var i=Map.MainMap;require(["esri/geometry/Extent","esri/SpatialReference"],function(a,b){extent=new a(i.extent.xmin,i.extent.ymin,i.extent.xmax,i.extent.ymax,new b({wkid:i.extent.spatialReference.wkid}))});var j=Map.GetSelectedAttributes(),k=Map.CreateMapExtentSpatialFilterObject(extent);0==Map.CurrentSpatialFilterType&&(k=Map.AddressFilterObj);var l=Map.CreateTemporalFilterObject(),m=Map.CreateMapFilterParameters(j,k,l),n=JSON.stringify(m);Map.LoadSpinner("Preparing Report"),Map.OpenModalOverlay(),$.ajax({url:c,type:"POST",data:{filter:n,coordx:e,coordy:f,scale:g,orgIDs:Map.UnMappedOrgIDs,phneDevice:b},success:function(a){null!=a&&($("#divReportPage").html(a),Map.CloseNavTrigger(),Map.ChartReportToggle(!1)),Map.CloseModalOverlay(),Map.ReportsPageOpen=!0,$("#chartsTab").hide()},error:function(a,b,c){Map.LoadErrorModal("Report - "+c,5,851e4)}})},Map.ReportBackToMap=function(){null!=$("#sb-site")[0]&&($("#sb-site")[0].style.display=""),Map.MainMap.visible=!0,null!=$("#divReportPage")[0]&&($("#divReportPage")[0].style.display="none"),$("#divReportPage").html(""),$("#mapnavigation").show(),$("#lblnavtrigger").show(),$("#nav-trigger").show(),null!=Map.PreviouslySelectedPin&&Map.GetDetailRecordInformation(Map.PreviouslySelectedPin,Map.DetailRecordID),Map.ChartReportToggle(!1),Map.ReportsPageOpen=!1},Map.ReportMapIt=function(a){for(var b=MapSettings.ZoomScale,c=Map.ResultPinGraphicsLayer.graphics,d=null,e=0;e<c.length;e++)if(null!=c[e].attributes){for(var f=0;f<c[e].attributes.IDs.length;f++)if(c[e].attributes.IDs[f]==a){d=c[e];break}if(null!=d)break}if(null!=d){null!=Map.ResultLabelGraphicsLayer&&Map.ResultLabelGraphicsLayer.clear(),null!=Map.ResultSelectionGraphicsLayer&&Map.ResultSelectionGraphicsLayer.clear(),Map.PreviouslySelectedPin=d,Map.DisplaySelectedValueGraphicsLayers(Map.PreviouslySelectedPin),Map.PinLabelSelected=!0,Map.DetailRecordID=a;try{Map.MainMap.centerAt(d.geometry)}catch(g){}Map.ReportBackToMap(),EventTracking.MapReportMapItClicked()}},Map.ChartReportToggle=function(a){a?($("#divReport").hide(),$("#divCharts").show(),$("#reportTab").removeClass("tabSelected"),$("#chartsTab").addClass("tabSelected"),$("#btnShowCrimeReport").hide(),$("#btnShowOffenderReport").hide()):($("#divReport").show(),$("#divCharts").hide(),$("#reportTab").addClass("tabSelected"),$("#chartsTab").removeClass("tabSelected"),$("#divReportSexOffenders").is(":visible")?($("#btnShowCrimeReport").show(),$("#btnShowOffenderReport").hide()):($("#btnShowCrimeReport").hide(),$("#btnShowOffenderReport").show()))},Map.FormatDate=function(a){var b=String(a.Date),c=b.substr(0,4),d=String(parseInt(b.substr(4,2))),e=String(parseInt(b.substr(6,2))),f=parseInt(b.substr(8,2)),g=b.substr(10,2),h=b.substr(12,2),i="";return 0==f&&(f=24),f>=13&&(f-=12),f=String(f),i="00"==h?"AM":"PM",d+"-"+e+"-"+c+" "+f+":"+g+" "+i},Map.FormatDatePhone=function(a){var b=String(a.Date),c=b.substr(0,4),d=String(parseInt(b.substr(4,2))),e=String(parseInt(b.substr(6,2))),f=parseInt(b.substr(8,2)),g=b.substr(10,2),h=b.substr(12,2),i="";return 0==f&&(f=24),f>=13&&(f-=12),f=String(f),i=0==h?"AM":"PM",a.CrimeSingleValue+"<br/>"+d+"-"+e+"-"+c+" "+f+":"+g+" "+i},Map.OpenAlertsSignup=function(){var a="/map/LoadAlertsSignup",b=Map.MainMap.extent.getCenter().x,c=Map.MainMap.extent.getCenter().y,d=Map.MainMap.getScale();Map.OpenModalOverlay(),$.ajax({url:a,type:"POST",data:{coordx:b,coordy:c,scale:d},success:function(a){null!=a&&($("#sb-site")[0].style.display="none",
null!=$("#mapnavigation")[0]&&($("#mapnavigation")[0].style.display="none"),null!=$("#lblnavtrigger")[0]&&($("#lblnavtrigger")[0].style.display="none"),null!=$("#nav-trigger")[0]&&($("#nav-trigger")[0].style.display="none"),Map.MainMap.visible=!1,$("#divReportPage")[0].style.display="none",$.slidebars.close(),Map.CloseFilterPanel(),$("#divAlertsSignUp").hide(),$("#divAlertsSignUp").html(a),2==MapSettings.MapType?$("#maplink").attr("href","/map/MapMobile"):($("#maplink").attr("href","javascript:Map.AlertsSignupBackToMap()"),$("#navMap").attr("href","javascript:Map.AlertsSignupBackToMap()")),Map.CloseNavTrigger(),Map.CloseModalOverlay(),$("#divAlertsSignUp").show(),Map.AlertsPageOpen=!0,2==MapSettings.MapType&&Map.LoadMobileSearchMenus())},error:function(a,b,c){Map.LoadErrorModal("Alerts Signup - "+c,5,851e4)}})},Map.AlertsSignupBackToMap=function(){$("#divAlertsSignUp").html(""),null!=$("#sb-site")[0]&&($("#sb-site")[0].style.display=""),$("#mapnavigation")[0].style.display="",$("#mapnavigation")[0].style.display="",$("#lblnavtrigger")[0].style.display="",Map.NavBarOpen=!1,Map.NavLayoutCheck(),Map.CloseNavTrigger(),Map.MainMap.visible=!0,null!=$("#divReportPage")[0]&&($("#divReportPage")[0].style.display="none"),null!=$("#divAlertsSignUp")[0]&&($("#divAlertsSignUp")[0].style.display="none"),$("#maplink").attr("href","/map"),Map.AlertsPageOpen=!1},Map.LoadShareModal=function(){var a=ScriptHelper.GetBaseUrl()+"/map/LoadShareMapModal",b=Map.GetSelectedAttributes(),c=JSON.stringify(b),d=Map.CreateMapExtentSpatialFilterObject(Map.MainMap.extent);0==Map.CurrentSpatialFilterType&&(d=Map.AddressFilterObj);var e=JSON.stringify(d),f=Map.CreateTemporalFilterObject(),g=JSON.stringify({StartDate:f.ExplicitStartDate,EndDate:f.ExplicitEndDate,FilterType:f.FilterType,PreviousNumDays:f.PreviousNumDays,PreviousID:f.PreviousID,PreviousName:f.PreviousName});$.slidebars.active("left")&&$.slidebars.toggle("left"),$.ajax({url:a,type:"GET",data:{detailRecordID:"",attFilter:c,spatFilter:e,spatFilterType:d.FilterType,tempFilter:g,agencyFilter:JSON.stringify(Map.AgencyFilter),mapType:MapSettings.MapType,bgLayerID:Map.OmegaBasemapLayer.id},success:function(a){return null!=a.sessionend?void Map.EndSession(a):($("#modalDialog").html(a),void(null!=$("#shareMapInput")[0]&&""==$("#shareMapInput")[0].value||(Map.CloseFilterPanel(),Map.OpenModalOverlay())))},error:function(a,b,c){Map.LoadErrorModal("Load Share Modal - "+c,5,851e4)}})},Map.LoadShareModalDetailRecord=function(a,b,c,d){var e=ScriptHelper.GetBaseUrl()+"/map/LoadShareMapModal",f=Map.GetSelectedAttributes(),g=JSON.stringify(f),h=Map.CreateMapExtentSpatialFilterObject(Map.MainMap.extent);0==Map.CurrentSpatialFilterType&&(h=Map.AddressFilterObj);var i=JSON.stringify(h),j=Map.CreateTemporalFilterObject(),k=JSON.stringify({StartDate:j.ExplicitStartDate,EndDate:j.ExplicitEndDate,FilterType:j.FilterType,PreviousNumDays:j.PreviousNumDays,PreviousID:j.PreviousID,PreviousName:j.PreviousName});$.slidebars.active("right")&&$.slidebars.toggle("right"),$.ajax({url:e,type:"POST",data:{detailRecordID:a,attFilter:g,spatFilter:i,spatFilterType:h.FilterType,tempFilter:k,agencyFilter:JSON.stringify(Map.AgencyFilter),mapType:MapSettings.MapType,bgLayerID:Map.OmegaBasemapLayer.id},success:function(a){return null!=a.sessionend?void Map.EndSession(a):($("#modalDialog").html(a),void Map.OpenModalOverlay())},error:function(a,b,c){Map.LoadErrorModal("Load Share Modal - "+c,5,851e4)}}),EventTracking.MapDetailsShareClicked()},Map.CopyShareURL=function(){navigator.userAgent.indexOf("iPhone",0)>-1||navigator.userAgent.indexOf("Android",0)>-1||navigator.userAgent.indexOf("iPad",0)>-1?(document.getElementById("shareMapInput").focus(),document.getElementById("shareMapInput").setSelectionRange(0,1e3)):(document.getElementById("shareMapInput").select(),document.execCommand("copy"))},Map.UpdateSummaryWhat=function(a){for(var b="",c=0,d=0,e=0,f=0,g=Map.GetSelectedAttributes(),h=!1,i=MapSettings.WhatAttributeCategories.length,j=null!=a&&a.ua.length>0,k=!1,l=0;l<i;l++)MapSettings.WhatAttributeCategories[l].id<16?d+=1:f+=1;for(var m=0;m<g.length;m++)for(var n=g[m],o=0;o<i;o++)if(MapSettings.WhatAttributeCategories[o].id==n){var p=MapSettings.WhatAttributeCategories[o].na;j&&a.ua.indexOf(parseInt(n))>-1&&(p+="*",k=!0),""==b?b=p:b+=", "+p,n>=16?(h=!0,e+=1):c+=1;break}return c+e==0?(b="No types selected",$("#lblSummaryDataAvail").hide()):k?$("#lblSummaryDataAvail").show():$("#lblSummaryDataAvail").hide(),null!=$("#summaryWhatText")[0]&&$("#summaryWhatText").text(b),b},Map.UpdateSummaryWhere=function(){var a="";if(0==Map.CurrentSpatialFilterType){for(var b=Map.AddressFilterObj,c=$.parseJSON(b.Filter),d=$("#whereBufferDistances")[0].options,e="",f=0;f<d.length;f++)if(1==d[f].selected){e=d[f].text;break}a="Constrained to "+e+" around "+c.ad}else a=1==Map.CurrentSpatialFilterType?"No spatial constraint":"Current Map View";return null!=$("#summaryWhereText")[0]&&$("#summaryWhereText").text(a),a},Map.UpdateSummaryWhen=function(){var a="",b="",c=null,d=null,e=null,f=null;return a="Previous"==Map.SelectedFilterType?Map.PreviousName:"Custom",null!=$("#dateFromDesc")[0]&&null!=$("#dateToDesc")[0]&&(e=$("#dateFromDesc")[0].innerHTML.split(","),"Today"==a||"Yesterday"==a?b=a+": "+e[0]+", "+e[1]:(f=$("#dateToDesc")[0].innerHTML.split(","),b=e[0]+", "+e[1]+" - "+f[0]+", "+f[1])),null!=$("#summaryWhenText")[0]&&$("#summaryWhenText").text(a),null!=$("#summaryWhenDateText")[0]&&$("#summaryWhenDateText").text(b),a},Map.LoadMobileMainMenu=function(){for(var a=0;a<MapSettings.BackgroundLayers.length;a++){var b=MapSettings.BackgroundLayers[a].id,c=MapSettings.BackgroundLayers[a].nm,d=null;switch(b){case 1:d="iconStreetMap";break;case 2:d="iconSatellite";break;case 3:d="iconTerrain"}$("#baseMapsMainMenu").append('<li class="nav-item"><a onclick="Map.MobileBasemapSelected(\''+b+'\')" href="javascript:void(0)"><span class="'+d+'"></span>'+c+"</a></li>")}$("#divRightPanel").hide(),$("#divMainMenu").show()},Map.EnableMobileMainMenu=function(){setTimeout(function(){$("#divRightPanel").hide(),$("#divMainMenu").show()},500)},Map.LoadMobileSearchMenus=function(){navigator.userAgent.indexOf("iPhone",0)>-1||navigator.userAgent.indexOf("Android",0)>-1?($("#divMainStandardLocationSearch").hide(),$("#divWhereStandardLocationSearch").hide(),$("#divDetailStandardLocationSearch").hide(),$("#divAlertsStandardLocationSearch").hide(),$("#divMainSecondaryLocationSearch").show(),$("#divWhereSecondaryLocationSearch").show(),$("#divDetailSecondaryLocationSearch").show(),$("#txtDetailRecordLocationSearch").show(),$("#divAlertsSecondaryLocationSearch").show(),$("#txtAlertsLocationSearch").show()):($("#divMainStandardLocationSearch").show(),$("#divWhereStandardLocationSearch").show(),$("#divDetailStandardLocationSearch").show(),$("#divAlertsStandardLocationSearch").show(),$("#divMainSecondaryLocationSearch").hide(),$("#divWhereSecondaryLocationSearch").hide(),$("#divDetailSecondaryLocationSearch").hide(),$("#divAlertsSecondaryLocationSearch").hide())},Map.OpenLocationSearch=function(a,b,c){var d="/map/OpenLocationSearch";Map.ToggleDetailRecordLoader(!0),$.ajax({url:d,type:"POST",data:{xcoord:b,ycoord:c},success:function(b){null!=b&&($.slidebars.close(),Map.CloseFilterPanel(),"detail"!=a&&"organizationdetail"!=a&&$("#divRightPanel").html(""),$("#divLocationSearch").html(b),$("#sb-site").hide(),$("#divAlertsSignUp").hide(),$("#divLocationSearch .k-autocomplete").css("width","100%"),$("#txtLocationSearchOrigin").val(a),$("#divLocationSearch").show()),Map.ToggleDetailRecordLoader(!1)},error:function(a,b,c){Map.ToggleDetailRecordLoader(!1),Map.LoadErrorModal("Open Location Search - "+c,5,851e4)}})},Map.CloseLocationSearch=function(){var a=$("#txtLocationSearchOrigin").val();"alert"==a?($("#divAlertsSignUp").show(),$("#sb-site").hide()):($("#divAlertsSignUp").hide(),$("#sb-site").show()),$("#txtLocationSearchOrigin").val(""),$("#divLocationSearch").html(""),$("#divLocationSearch").hide()},Map.ClearLocationSearch=function(){$("#locationSearch").val("")},Map.MobileMapLocationSuggestSelected=function(a){var b=this.dataItem(a.item.index()),c=$("#txtLocationSearchOrigin").val();Map.SelectedLocationSuggestion=b,"main"==c?$("#txtLocationSearch").val(Map.SelectedLocationSuggestion.Text):"where"==c?($("#txtWhereLocationSearch").val(Map.SelectedLocationSuggestion.Text),Map.SelectedLocationSuggestionWherePanel=Map.SelectedLocationSuggestion):"detail"==c?($("#txtDetailRecordLocationSearch").val(Map.SelectedLocationSuggestion.Text),Map.SelectedLocationSuggestionRecordDetail=Map.SelectedLocationSuggestion):"organizationdetail"==c?($("#txtOrganizationLocationSearch").val(Map.SelectedLocationSuggestion.Text),Map.SelectedLocationSuggestionRecordDetail=Map.SelectedLocationSuggestion):"alert"==c&&$("#txtAlertsLocationSearch").val(Map.SelectedLocationSuggestion.Text),$(".clearSearch").hide(),Map.LocationSelectionFlag=!0},Map.MobileMapClearAddressSearch=function(a,b){switch(a.val(""),Map.SelectedLocationSuggestion=null,Map.RemoveAddressGraphic(),b){case"main":$("#topToolbar .clearSearch").hide();break;case"where":$("#tab-content3 .clearSearch").hide();break;case"detail":$("#tblHowCloseAmI .clearLocationSearch").hide();break;case"organizationdetail":$("#tblHowCloseAmI .clearLocationSearch").hide()}},Map.MobileMapGeocodeSearchAddress=function(a,b){var c="";if(null!=$("#locationSearch")[0]&&(c=$("#locationSearch").val()),null!=Map.SelectedLocationSuggestion||""!=c){null!=Map.SelectedLocationSuggestion&&(c=Map.SelectedLocationSuggestion.Text),c=c.replace(/[^\w\s\.,]/gi,"");var d="";if((null!=Map.SelectedLocationSuggestion&&"0"==Map.SelectedLocationSuggestion.Source||""!=c)&&(d=ScriptHelper.GetBaseUrl()+"/map/GeocodeLocation"),""!=d){var e=$("#txtLocationSearchOrigin").val();null!=Map.SelectedLocationSuggestion?$.ajax({url:d,type:"POST",data:{location:c,id:Map.SelectedLocationSuggestion.MagicKey,iscollection:Map.SelectedLocationSuggestion.IsCollection,maxlocations:MapSettings.MaxNumSuggestions},success:function(d){if(null!=d.sessionend)return void Map.EndSession(d);if($("#divLocationSearch").html(""),$("#divLocationSearch").hide(),$("#sb-site").show(),"main"==e&&($("#topToolbar .clearSearch").show(),Map.GoToSelectedLocation(d)),"where"==e){$("#tab-content3 .clearSearch").show(),$.slidebars.open("Error500.html"),$("#txtWhereLocationSearch").val(c);var f=0;null!=$("#whereBufferDistances")[0]&&(f=$("#whereBufferDistances")[0].value);var g="";try{g=$.parseJSON(d)}catch(h){return}Map.AddressFilterObj=Map.CreateAddressSpatialFilterObject(c,g.locations[0].feature.geometry.x,g.locations[0].feature.geometry.y,f),Map.ApplySpatialFilter()}if("detail"==e){$("#tblHowCloseAmI .clearLocationSearch").show();var i=!1;(navigator.userAgent.indexOf("iPhone",0)>-1||navigator.userAgent.indexOf("Android",0)>-1)&&(i=!0),0==i&&$.slidebars.open("Error500.html"),Map.GeocodeDetailRecordLocation(a,b,c)}"organizationdetail"==e&&($("#tblHowCloseAmI .clearLocationSearch").show(),$.slidebars.open("Error500.html"),Map.GeocodeOrganizationLocation(a,b,c)),"alert"==e&&($("#divAlertsSecondaryLocationSearch .clearSearch").hide(),Map.CloseLocationSearch())},error:function(a,b,c){Map.LoadErrorModal("Geocode Search Address - "+c,5,851e4)}}):$.ajax({url:d,type:"POST",data:{location:c,id:"",iscollection:!1,maxlocations:MapSettings.MaxNumSuggestions},success:function(a){$("#divLocationSearch").html(""),$("#divLocationSearch").hide(),$("#sb-site").show(),Map.GoToSelectedLocation(a),"main"==e&&$("#topToolbar .clearSearch").show(),"where"==e&&$.slidebars.open("Error500.html"),"detail"==e&&$.slidebars.open("Error500.html"),"organizationdetail"==e&&$.slidebars.open("Error500.html")},error:function(a,b,c){Map.LoadErrorModal("Geocode Search Address - "+c,5,851e4)}})}}},Map.MobileMapLocationSuggestOpen=function(){$("div.k-list-container").width("100%")},Map.ExitCrimeAlert=function(){$("#topToolbarAlert").hide(),$("#topToolbar").show(),MapSettings.CrimeAlertID=null,$("#leftToolbar").show(),1==MapSettings.MapType&&$("#sb-site").css("padding","100px 0px 0px 75px"),Map.InitiateSearchRequest()},Map.MobilePanelClick=function(a){if(null==a)$.slidebars.open("Error500.html"),content=a=$("[id^=tab]:checked").siblings("div"),"tab-content1"!=content[0].id&&"tab-content2"!=content[0].id||Map.GetAvailableAttributes(),content.show();else switch(a.id){case"tab1":$("#tab-content1").is(":visible")?($("#tab-content1").hide(),$.slidebars.close()):($("#tab-content1").show(),$("#tab-content2").hide(),$("#tab-content3").hide(),$("#tab-content4").hide(),Map.GetAvailableAttributes());break;case"tab2":$("#tab-content2").is(":visible")?($("#tab-content2").hide(),$.slidebars.close()):($("#tab-content1").hide(),$("#tab-content2").show(),$("#tab-content3").hide(),$("#tab-content4").hide(),Map.GetAvailableAttributes());break;case"tab3":$("#tab-content3").is(":visible")?($("#tab-content3").hide(),$.slidebars.close()):($("#tab-content1").hide(),$("#tab-content2").hide(),$("#tab-content3").show(),$("#tab-content4").hide(),Map.LoadMobileSearchMenus());break;case"tab4":$("#tab-content4").is(":visible")?($("#tab-content4").hide(),$.slidebars.close()):($("#tab-content1").hide(),$("#tab-content2").hide(),$("#tab-content3").hide(),$("#tab-content4").show())}},Map.MobilePanelOpen=function(a){switch($(".sb-left").hasClass("sb-active")||$.slidebars.open("Error500.html"),$("#tab1").prop("checked",!1),$("#tab2").prop("checked",!1),$("#tab3").prop("checked",!1),$("#tab4").prop("checked",!1),$("#tab-content1").hide(),$("#tab-content2").hide(),$("#tab-content3").hide(),$("#tab-content4").hide(),a){case"summary":$("#tab1").prop("checked",!0),Map.MobilePanelClick($("#tab1")[0]),EventTracking.MapSummaryOpenPanel();break;case"what":$("#tab2").prop("checked",!0),Map.MobilePanelClick($("#tab2")[0]),EventTracking.MapWhatOpenPanel();break;case"where":$("#tab3").prop("checked",!0),Map.MobilePanelClick($("#tab3")[0]),EventTracking.MapWhereOpenPanel();break;case"when":$("#tab4").prop("checked",!0),Map.MobilePanelClick($("#tab4")[0]),EventTracking.MapWhenOpenPanel()}},Map.SetPrintMap=function(){var a=$("#dateRangeVal")[0].innerHTML,b="/Print?";a=a.substring(0,a.indexOf("(")-1);var c=a.split("to"),d=c[0].trim(),e=c[1].trim(),f=Map.GetSelectedAttributes(),g=Map.CreateTemporalFilterObject(),h=JSON.stringify(f),i=JSON.stringify(Map.PrintMapExtent),j=JSON.stringify(g),k=JSON.stringify(Map.AgencyFilter),l="",m=1,n=Map.OffenderDisclaimerAccepted;null!=Map.OmegaBasemapLayer&&(m=Map.OmegaBasemapLayer.id),b+="dteFrom=",b+=d,b+="&dteTo=",b+=e,b+="&attr=",b+=h,b+="&ext=",b+=i,b+="&tmpfilt=",b+=j,b+="&agfilt=",b+=k,b+="&bmpid=",b+=m,b+="&disacpt=",b+=n,0==Map.CurrentSpatialFilterType&&null!=Map.CenterPoint&&(l=JSON.stringify(Map.CenterPoint),b+="&spfilt=",b+=l,b+="&bfrDst=",b+=Map.PrintMapBufferDistance,b+="&bfrAddr=",b+=Map.PrintMapBufferAddress),$("#btnPrintMap").attr("href",b)},Map.LoadSpinner=function(a){$("#modalDialog").html(""),$("#modalDialog").html('<div class="initializeContentModal"><div id="floatingCirclesG"><div class="f_circleG" id="frotateG_01"></div><div class="f_circleG" id="frotateG_02"></div><div class="f_circleG" id="frotateG_03"></div><div class="f_circleG" id="frotateG_04"></div><div class="f_circleG" id="frotateG_05"></div><div class="f_circleG" id="frotateG_06"></div><div class="f_circleG" id="frotateG_07"></div><div class="f_circleG" id="frotateG_08"></div></div><p style="margin:25px;">'+a+"...</p></div>")},Map.ShowCrimeReport=function(){$("#btnShowCrimeReport").hide(),$("#btnShowOffenderReport").show(),$("[id*='divOffenderReportPanelDivider']").hide(),$("[id*='divOffenderReportHeader']").hide(),$("[id*='divReportSexOffenders']").hide(),$("[id*='divCrimeReportHeader']").show(),$("[id*='divReportCrimeIncidents']").show(),$("#chartsTab").show()},Map.ShowOffenderReport=function(){$("#btnShowOffenderReport").hide(),$("#btnShowCrimeReport").show(),$("[id*='divOffenderReportPanelDivider']").show(),$("[id*='divOffenderReportHeader']").show(),$("[id*='divReportSexOffenders']").show(),$("[id*='divCrimeReportHeader']").hide(),$("[id*='divReportCrimeIncidents']").hide(),$("#chartsTab").hide()},Map.OpenPictometry=function(a,b,c,d,e,f,g,h){var i=ScriptHelper.GetBaseUrl()+"/Pictometry";i+="?xcoord="+parseFloat(a).toFixed(4),i+="&ycoord="+parseFloat(b).toFixed(4),i+="&lid="+c,i+="&typnme="+d,i+="&address="+e,i+="&crmdte="+f,i+="&typ="+g,i+="&orgid="+h;var j=encodeURI(i);window.open(j,"_blank"),EventTracking.PictometryPageOpened()};